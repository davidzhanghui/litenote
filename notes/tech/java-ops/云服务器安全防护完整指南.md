# äº‘æœåŠ¡å™¨å®‰å…¨é˜²æŠ¤å®Œæ•´æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ•´åˆäº†è…¾è®¯äº‘å’Œé˜¿é‡Œäº‘ECSæœåŠ¡å™¨çš„å®‰å…¨é˜²æŠ¤æœ€ä½³å®è·µï¼Œæä¾›ç³»ç»ŸåŒ–ã€å¯æ‰§è¡Œçš„å®‰å…¨åŠ å›ºæ–¹æ¡ˆã€‚æ¶µç›–ç½‘ç»œå±‚ã€ç³»ç»Ÿå±‚ã€åº”ç”¨å±‚å’Œæ•°æ®å®‰å…¨å››ä¸ªç»´åº¦ï¼Œå¸®åŠ©æ‚¨æ„å»ºçºµæ·±é˜²å¾¡ä½“ç³»ï¼Œæœ‰æ•ˆé™ä½æœåŠ¡å™¨è¢«æ”»å‡»çš„é£é™©ã€‚

### æ ¸å¿ƒé˜²æŠ¤ç†å¿µ

1. **æœ€å°åŒ–æš´éœ²åŸåˆ™**ï¼šåªå¼€æ”¾ä¸šåŠ¡å¿…éœ€ç«¯å£ï¼Œä½¿ç”¨å®‰å…¨ç»„å’Œé˜²ç«å¢™è¿›è¡Œä¸¥æ ¼çš„è®¿é—®æ§åˆ¶
2. **çºµæ·±é˜²å¾¡ç­–ç•¥**ï¼šç½‘ç»œå±‚â†’ç³»ç»Ÿå±‚â†’åº”ç”¨å±‚â†’æ•°æ®å±‚ï¼Œå¤šå±‚æ¬¡å®‰å…¨é˜²æŠ¤
3. **æŒç»­ç›‘æ§å®¡è®¡**ï¼šå®æ—¶ç›‘æ§ã€æ—¥å¿—å®¡è®¡ã€å®šæœŸå®‰å…¨æ£€æŸ¥
4. **äº‘å¹³å°ååŒ**ï¼šç»“åˆäº‘å‚å•†å®‰å…¨äº§å“ï¼Œå®ç°è‡ªåŠ¨åŒ–å®‰å…¨ç®¡ç†

---

## ä¸€ã€ç½‘ç»œå±‚å®‰å…¨

### 1.1 å®‰å…¨ç»„é…ç½®ï¼ˆæ§åˆ¶å°ï¼‰

#### é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®

| æ“ä½œ | é…ç½®è¦ç‚¹ |
|------|----------|
| **SSHè®¿é—®** | 22ç«¯å£â†’ä»…å…è®¸è¿ç»´IPæ®µï¼Œå»ºè®®ä¿®æ”¹ä¸ºéæ ‡å‡†ç«¯å£ï¼ˆå¦‚2222ï¼‰ |
| **WebæœåŠ¡** | 80/443ç«¯å£â†’æŒ‰éœ€å¼€æ”¾0.0.0.0/0 |
| **æ•°æ®åº“** | 3306/6379ç«¯å£â†’ä»…å…è®¸åº”ç”¨æœåŠ¡å™¨IPæˆ–127.0.0.1 |
| **åº”ç”¨ç«¯å£** | è‡ªå®šä¹‰ç«¯å£â†’ä¸¥æ ¼é™åˆ¶æºIP |
| **é»˜è®¤ç­–ç•¥** | æ‹’ç»æ‰€æœ‰æœªæ˜ç¡®å…è®¸çš„å…¥ç«™æµé‡ |

#### è…¾è®¯äº‘å®‰å…¨ç»„é…ç½®

**å…¥ç«™è§„åˆ™ï¼š**
- **SSH**: ç«¯å£22ï¼ˆæˆ–2222ï¼‰â†’ é™åˆ¶æºIPï¼ˆä½¿ç”¨`curl ip.sb`è·å–åŠå…¬ç½‘å‡ºå£IPï¼‰
- **HTTP/HTTPS**: ç«¯å£80/443 â†’ æŒ‰éœ€å¼€æ”¾
- **åº”ç”¨ç«¯å£**: æŒ‰ä¸šåŠ¡éœ€æ±‚ä¸¥æ ¼é™åˆ¶æºIP

**å‡ºç«™è§„åˆ™ï¼š**
- é»˜è®¤å…è®¸å…¨éƒ¨ï¼ˆæŒ‰ä¸šåŠ¡éœ€æ±‚å¯è¿›ä¸€æ­¥é™åˆ¶ï¼‰

âš ï¸ **é‡è¦è­¦å‘Š**ï¼š
- ç»ä¸å¯¹SSHç«¯å£å¼€æ”¾0.0.0.0/0ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„æ”»å‡»å…¥å£
- æ•°æ®åº“ç«¯å£ä¸¥ç¦å¯¹å¤–ç½‘å¼€æ”¾
- å®šæœŸå®¡è®¡å®‰å…¨ç»„è§„åˆ™ï¼Œç§»é™¤ä¸å¿…è¦çš„è§„åˆ™

### 1.2 ç½‘ç»œéš”ç¦»

#### VPCç§æœ‰ç½‘ç»œé…ç½®
```bash
# æ¨èæ¶æ„
- å…¬æœ‰å­ç½‘ï¼šSLB/NAT Gateway
- ç§æœ‰å­ç½‘ï¼šåº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“
- ç®¡ç†å­ç½‘ï¼šå ¡å’æœºã€è¿ç»´å·¥å…·
```

#### è®¿é—®æ§åˆ¶æœ€ä½³å®è·µ
- ä½¿ç”¨VPNæˆ–ä¸“çº¿è¿›è¡Œè¿ç»´è®¿é—®
- åº”ç”¨æœåŠ¡å™¨æ”¾ç½®åœ¨ç§æœ‰å­ç½‘
- é€šè¿‡NATç½‘å…³æˆ–SLBè®¿é—®å¤–ç½‘
- å¯ç”¨Cloud Enterprise Networkè¿›è¡Œè·¨åŒºåŸŸäº’è”

---

## äºŒã€SSHå®‰å…¨åŠ å›ºï¼ˆé‡ä¸­ä¹‹é‡ï¼‰

### 2.1 SSHå¯†é’¥è®¤è¯é…ç½®

#### æ­¥éª¤1ï¼šç”ŸæˆSSHå¯†é’¥å¯¹ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰

```bash
# ç”Ÿæˆed25519å¯†é’¥ï¼ˆæ¨èï¼Œæ›´å®‰å…¨æ›´å¿«ï¼‰
ssh-keygen -t ed25519 -f ~/.ssh/cloud_ecs -C "your-email@example.com"

# æˆ–ç”ŸæˆRSA 4096ä½å¯†é’¥
ssh-keygen -t rsa -b 4096 -f ~/.ssh/cloud_ecs -C "your-email@example.com"

# ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id -i ~/.ssh/cloud_ecs.pub -p 22 root@your-server-ip
```

#### æ­¥éª¤2ï¼šSSHé…ç½®åŠ å›ºï¼ˆæœåŠ¡å™¨æ‰§è¡Œï¼‰

```bash
# å¤‡ä»½åŸé…ç½®
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak.$(date +%Y%m%d)

# ç¼–è¾‘SSHé…ç½®
sudo vim /etc/ssh/sshd_config
```

**å®‰å…¨é…ç½®å‚æ•°ï¼š**

```sshd_config
# åè®®å’Œç«¯å£
Protocol 2
Port 2222                        # ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œå¢åŠ æ‰«æéš¾åº¦

# è®¤è¯é…ç½®
PermitRootLogin no               # ç¦æ­¢rootç›´æ¥ç™»å½•
PasswordAuthentication no        # ç¦ç”¨å¯†ç è®¤è¯
PubkeyAuthentication yes         # å¯ç”¨å…¬é’¥è®¤è¯
AuthorizedKeysFile .ssh/authorized_keys
PermitEmptyPasswords no          # ç¦æ­¢ç©ºå¯†ç 

# ç™»å½•é™åˆ¶
MaxAuthTries 3                   # æœ€å¤š3æ¬¡è®¤è¯å°è¯•
MaxSessions 2                    # æœ€å¤§ä¼šè¯æ•°
LoginGraceTime 30                # ç™»å½•è¶…æ—¶30ç§’
ClientAliveInterval 300          # å®¢æˆ·ç«¯ä¿æ´»é—´éš”5åˆ†é’Ÿ
ClientAliveCountMax 2            # æœ€å¤š2æ¬¡ä¿æ´»æ£€æµ‹
AllowUsers deploy admin          # ä»…å…è®¸æŒ‡å®šç”¨æˆ·ç™»å½•

# å®‰å…¨é€‰é¡¹
X11Forwarding no                 # ç¦ç”¨X11è½¬å‘
AllowTcpForwarding no            # ç¦ç”¨TCPè½¬å‘
PermitTunnel no                  # ç¦ç”¨éš§é“
UsePAM yes                       # ä½¿ç”¨PAMè®¤è¯
ChallengeResponseAuthentication no

# æ—¥å¿—
SyslogFacility AUTH
LogLevel VERBOSE                 # è¯¦ç»†æ—¥å¿—ä¾¿äºå®¡è®¡
```

#### æ­¥éª¤3ï¼šæµ‹è¯•å’Œé‡å¯

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo sshd -t

# é‡å¯SSHæœåŠ¡
sudo systemctl restart sshd

# âš ï¸ é‡è¦ï¼šæ–°å¼€ç»ˆç«¯æµ‹è¯•è¿æ¥ï¼Œä¸è¦å…³é—­å½“å‰ä¼šè¯
ssh -i ~/.ssh/cloud_ecs -p 2222 deploy@your-server-ip
```

### 2.2 SSHè®¿é—®æ§åˆ¶

#### ä½¿ç”¨hosts.allow/denyé™åˆ¶IP

```bash
# /etc/hosts.allow
sshd: 192.168.1.0/24, 10.0.0.0/8

# /etc/hosts.deny
sshd: ALL
```

#### SSHå¯†é’¥ç®¡ç†

```bash
# è®¾ç½®æ­£ç¡®çš„SSHç›®å½•æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/id_*
chmod 644 ~/.ssh/id_*.pub

# å®šæœŸå®¡è®¡authorized_keys
cat ~/.ssh/authorized_keys
```

---

## ä¸‰ã€ç³»ç»Ÿå±‚å®‰å…¨åŠ å›º

### 3.1 ç³»ç»Ÿæ›´æ–°å’Œè¡¥ä¸ç®¡ç†

#### Ubuntu/Debianç³»ç»Ÿ

```bash
# ç³»ç»Ÿæ›´æ–°
sudo apt update && sudo apt upgrade -y
sudo apt autoremove -y
sudo apt autoclean

# é…ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–°
sudo apt install unattended-upgrades -y
sudo dpkg-reconfigure -plow unattended-upgrades

# ç¼–è¾‘é…ç½®
sudo vim /etc/apt/apt.conf.d/50unattended-upgrades
# å–æ¶ˆæ³¨é‡Š: "${distro_id}:${distro_codename}-security";
```

#### CentOS/RHELç³»ç»Ÿ

```bash
# ç³»ç»Ÿæ›´æ–°
sudo yum update -y
# æˆ–æ–°ç‰ˆæœ¬
sudo dnf update -y

# é…ç½®è‡ªåŠ¨æ›´æ–°
sudo dnf install dnf-automatic -y
sudo systemctl enable --now dnf-automatic.timer
```

### 3.2 ç”¨æˆ·å’Œæƒé™ç®¡ç†

#### åˆ›å»ºç®¡ç†ç”¨æˆ·

```bash
# åˆ›å»ºérootç®¡ç†ç”¨æˆ·
sudo adduser deploy
sudo usermod -aG sudo deploy         # Ubuntu
sudo usermod -aG wheel deploy        # CentOS

# è®¾ç½®å¼ºå¯†ç 
sudo passwd deploy

# ç¦ç”¨rootå¯†ç ç™»å½•
sudo passwd -l root

# é…ç½®sudoå…å¯†ï¼ˆå¯é€‰ï¼Œè°¨æ…ä½¿ç”¨ï¼‰
echo "deploy ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/deploy
sudo chmod 440 /etc/sudoers.d/deploy
```

#### åˆ é™¤é»˜è®¤å’Œä¸å¿…è¦ç”¨æˆ·

```bash
# åˆ é™¤ä¸å¿…è¦çš„ç³»ç»Ÿç”¨æˆ·
for u in adm lp sync shutdown halt mail news uucp operator games gopher ftp; do
    id $u &>/dev/null && sudo userdel -r $u
done

# åˆ é™¤ä¸å¿…è¦çš„ç»„
for g in adm lp mail news uucp games dip pppusers popusers slipusers; do
    getent group $g &>/dev/null && sudo groupdel $g
done
```

#### å¼ºåŒ–å¯†ç ç­–ç•¥

```bash
# ç¼–è¾‘å¯†ç ç­–ç•¥é…ç½®
sudo vim /etc/login.defs
```

ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š
```conf
PASS_MAX_DAYS   90      # å¯†ç æœ€é•¿æœ‰æ•ˆæœŸ90å¤©
PASS_MIN_DAYS   1       # å¯†ç æœ€çŸ­ä½¿ç”¨å¤©æ•°
PASS_MIN_LEN    12      # æœ€å°å¯†ç é•¿åº¦12ä½
PASS_WARN_AGE   7       # å¯†ç è¿‡æœŸå‰7å¤©è­¦å‘Š
```

é…ç½®PAMå¯†ç å¤æ‚åº¦ï¼š
```bash
# Ubuntu
sudo apt install libpam-pwquality -y
sudo vim /etc/pam.d/common-password

# æ·»åŠ æˆ–ä¿®æ”¹
password requisite pam_pwquality.so retry=3 minlen=12 difok=3 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1

# CentOS
sudo yum install pam_pwquality -y
sudo vim /etc/pam.d/system-auth
```

### 3.3 è‡ªåŠ¨é€€å‡ºå’Œå®¡è®¡é…ç½®

```bash
# é…ç½®è‡ªåŠ¨é€€å‡º
echo "TMOUT=300" | sudo tee -a /etc/profile          # 5åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨æ³¨é”€
echo "readonly TMOUT" | sudo tee -a /etc/profile     # é˜²æ­¢ç”¨æˆ·ä¿®æ”¹
echo "export TMOUT" | sudo tee -a /etc/profile

# é…ç½®å‘½ä»¤å†å²é™åˆ¶
echo "HISTSIZE=1000" | sudo tee -a /etc/profile
echo "HISTFILESIZE=1000" | sudo tee -a /etc/profile
echo "HISTTIMEFORMAT='%F %T '" | sudo tee -a /etc/profile   # è®°å½•æ—¶é—´æˆ³

# é€€å‡ºæ—¶æ¸…é™¤å†å²
echo "rm -f \$HOME/.bash_history" | sudo tee -a /etc/skel/.bash_logout

# åº”ç”¨é…ç½®
source /etc/profile
```

### 3.4 ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
systemctl list-unit-files --type=service

# ç¦ç”¨å¸¸è§ä¸å¿…è¦çš„æœåŠ¡
sudo systemctl disable telnet rsh rlogin cups bluetooth avahi-daemon

# æŸ¥çœ‹è¿è¡Œä¸­çš„æœåŠ¡
systemctl list-units --type=service --state=running

# ç¤ºä¾‹ï¼šç¦ç”¨å¹¶åœæ­¢æœåŠ¡
sudo systemctl disable cups
sudo systemctl stop cups
```

### 3.5 å†…æ ¸å®‰å…¨å‚æ•°ä¼˜åŒ–

åˆ›å»ºå†…æ ¸å®‰å…¨é…ç½®æ–‡ä»¶ï¼š

```bash
sudo vim /etc/sysctl.d/99-security-hardening.conf
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```conf
# ==================== ç½‘ç»œå®‰å…¨ ====================
# é˜²æ­¢SYNæ´ªæ°´æ”»å‡»
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 2048
net.core.somaxconn = 1024

# IPè½¬å‘æ§åˆ¶
net.ipv4.ip_forward = 0
net.ipv6.conf.all.forwarding = 0

# ç¦æ­¢æºè·¯ç”±
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0

# ç¦æ­¢ICMPé‡å®šå‘
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv6.conf.all.accept_redirects = 0

# å¯ç”¨åå‘è·¯å¾„è¿‡æ»¤ï¼ˆé˜²IPæ¬ºéª—ï¼‰
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# è®°å½•æ¬ºéª—åŒ…ã€æºè·¯ç”±åŒ…å’Œé‡å®šå‘åŒ…
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# ICMPé…ç½®
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1

# ==================== ç³»ç»Ÿå®‰å…¨ ====================
# åœ°å€ç©ºé—´éšæœºåŒ–ï¼ˆKASLRï¼‰
kernel.randomize_va_space = 2

# ç¦æ­¢core dumpï¼ˆé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰
fs.suid_dumpable = 0
kernel.core_uses_pid = 1

# é™åˆ¶ç³»ç»Ÿæ—¥å¿—è®¿é—®
kernel.dmesg_restrict = 1

# é™åˆ¶å†…æ ¸æŒ‡é’ˆæ³„éœ²
kernel.kptr_restrict = 2

# è¿›ç¨‹æ•°é™åˆ¶ï¼ˆé˜²Fork Bombï¼‰
kernel.pid_max = 65536

# å…±äº«å†…å­˜é™åˆ¶
kernel.shmmax = 68719476736
kernel.shmall = 4294967296
```

åº”ç”¨é…ç½®ï¼š
```bash
sudo sysctl --system
sudo sysctl -p /etc/sysctl.d/99-security-hardening.conf
```

### 3.6 SELinux/AppArmorå¯ç”¨

#### CentOS - SELinux

```bash
# æ£€æŸ¥SELinuxçŠ¶æ€
getenforce

# å¯ç”¨SELinux
sudo setenforce 1

# æ°¸ä¹…å¯ç”¨
sudo vim /etc/selinux/config
# è®¾ç½®: SELINUX=enforcing

# æŸ¥çœ‹SELinuxçŠ¶æ€
sestatus
```

#### Ubuntu - AppArmor

```bash
# æ£€æŸ¥AppArmorçŠ¶æ€
sudo aa-status

# å®‰è£…AppArmorå·¥å…·
sudo apt install apparmor-utils apparmor-profiles -y

# è®¾ç½®æ‰€æœ‰é…ç½®ä¸ºenforceæ¨¡å¼
sudo aa-enforce /etc/apparmor.d/*

# æŸ¥çœ‹çŠ¶æ€
sudo apparmor_status
```


---

## å››ã€é˜²ç«å¢™é…ç½®

### 4.1 UFWé˜²ç«å¢™ï¼ˆUbuntuæ¨èï¼‰

```bash
# å®‰è£…UFW
sudo apt install ufw -y

# è®¾ç½®é»˜è®¤ç­–ç•¥
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 2222/tcp comment 'SSH custom port'
sudo ufw allow 80/tcp comment 'HTTP'
sudo ufw allow 443/tcp comment 'HTTPS'

# é™åˆ¶SSHè®¿é—®é€Ÿç‡ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
sudo ufw limit 2222/tcp

# å…è®¸ç‰¹å®šIPè®¿é—®
sudo ufw allow from 192.168.1.100 to any port 3306

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status verbose
sudo ufw status numbered
```

### 4.2 firewalldé˜²ç«å¢™ï¼ˆCentOSæ¨èï¼‰

```bash
# å®‰è£…å¹¶å¯åŠ¨firewalld
sudo yum install firewalld -y
sudo systemctl start firewalld
sudo systemctl enable firewalld

# è®¾ç½®é»˜è®¤åŒºåŸŸ
sudo firewall-cmd --set-default-zone=public

# æ·»åŠ æœåŠ¡å’Œç«¯å£
sudo firewall-cmd --permanent --add-port=2222/tcp
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https

# é™åˆ¶ç‰¹å®šIPè®¿é—®
sudo firewall-cmd --permanent --zone=public --add-rich-rule='
  rule family="ipv4"
  source address="192.168.1.100/32"
  port protocol="tcp" port="3306" accept'

# é‡è½½é…ç½®
sudo firewall-cmd --reload

# æŸ¥çœ‹çŠ¶æ€
sudo firewall-cmd --list-all
```

---

## äº”ã€å…¥ä¾µæ£€æµ‹å’Œé˜²æŠ¤

### 5.1 Fail2Banå®‰è£…é…ç½®

```bash
# å®‰è£…Fail2Ban
sudo apt install fail2ban -y    # Ubuntu
sudo yum install fail2ban -y    # CentOS

# åˆ›å»ºæœ¬åœ°é…ç½®
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo vim /etc/fail2ban/jail.local
```

**Fail2Bané…ç½®ç¤ºä¾‹ï¼š**

```ini
[DEFAULT]
# é»˜è®¤å°ç¦æ—¶é—´ï¼ˆç§’ï¼‰
bantime = 3600
# ç›‘æ§æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
findtime = 600
# æœ€å¤§å°è¯•æ¬¡æ•°
maxretry = 3
# å¿½ç•¥çš„IPï¼ˆç™½åå•ï¼‰
ignoreip = 127.0.0.1/8 ::1 192.168.1.0/24

# ========== SSHä¿æŠ¤ ==========
[sshd]
enabled = true
port = 2222
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
bantime = 7200

# ========== Nginxä¿æŠ¤ ==========
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[nginx-noscript]
enabled = true
port = http,https
filter = nginx-noscript
logpath = /var/log/nginx/access.log
maxretry = 6
bantime = 86400

[nginx-badbots]
enabled = true
port = http,https
filter = nginx-badbots
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

# ========== MySQLä¿æŠ¤ ==========
[mysqld-auth]
enabled = true
filter = mysqld-auth
port = 3306
logpath = /var/log/mysql/error.log
maxretry = 3
bantime = 3600
```

å¯åŠ¨Fail2Banï¼š
```bash
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# æŸ¥çœ‹çŠ¶æ€
sudo fail2ban-client status
sudo fail2ban-client status sshd
```

### 5.2 æ–‡ä»¶å®Œæ•´æ€§ç›‘æ§ - AIDE

```bash
# å®‰è£…AIDE
sudo apt install aide -y        # Ubuntu
sudo yum install aide -y        # CentOS

# åˆå§‹åŒ–æ•°æ®åº“
sudo aideinit

# ç§»åŠ¨æ•°æ®åº“åˆ°æ­£ç¡®ä½ç½®
sudo mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# æ‰‹åŠ¨æ£€æŸ¥
sudo aide --check

# è®¾ç½®å®šæœŸæ£€æŸ¥ï¼ˆæ¯æ—¥å‡Œæ™¨2ç‚¹ï¼‰
echo "0 2 * * * root /usr/bin/aide --check | mail -s 'AIDE Report' admin@yourdomain.com" | sudo tee -a /etc/crontab
```

### 5.3 å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ - OSSEC

```bash
# ä¸‹è½½OSSEC
cd /tmp
wget https://github.com/ossec/ossec-hids/archive/3.7.0.tar.gz
tar -xzf 3.7.0.tar.gz
cd ossec-hids-3.7.0

# ç¼–è¯‘å®‰è£…
sudo ./install.sh
# é€‰æ‹© local å®‰è£…ç±»å‹

# å¯åŠ¨OSSEC
sudo /var/ossec/bin/ossec-control start

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/ossec/logs/alerts/alerts.log
```

**OSSECåŸºæœ¬é…ç½®ï¼š**

```xml
<!-- /var/ossec/etc/ossec.conf -->
<ossec_config>
  <global>
    <email_notification>yes</email_notification>
    <email_to>admin@yourdomain.com</email_to>
    <smtp_server>localhost</smtp_server>
    <email_from>ossec@yourdomain.com</email_from>
  </global>

  <!-- æ–‡ä»¶å®Œæ•´æ€§ç›‘æ§ -->
  <syscheck>
    <frequency>7200</frequency>
    <directories check_all="yes">/etc,/usr/bin,/usr/sbin</directories>
    <directories check_all="yes">/var/www/html</directories>
  </syscheck>

  <!-- Rootkitæ£€æµ‹ -->
  <rootcheck>
    <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
    <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
  </rootcheck>
</ossec_config>
```

---

## å…­ã€åº”ç”¨å±‚å®‰å…¨

### 6.1 Nginxå®‰å…¨é…ç½®

```nginx
# /etc/nginx/nginx.conf
http {
    # éšè—ç‰ˆæœ¬å·
    server_tokens off;
    
    # å®‰å…¨å“åº”å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # é™åˆ¶è¯·æ±‚å¤§å°
    client_max_body_size 10M;
    client_body_buffer_size 128k;
    
    # è¶…æ—¶è®¾ç½®
    client_body_timeout 12;
    client_header_timeout 12;
    keepalive_timeout 15;
    send_timeout 10;
    
    # è¿æ¥å’Œè¯·æ±‚é™åˆ¶
    limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
    limit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=5r/s;
    
    # ç¼“å†²åŒºå¤§å°é™åˆ¶
    client_body_buffer_size 1K;
    client_header_buffer_size 1k;
    large_client_header_buffers 2 1k;
}

server {
    listen 80;
    server_name example.com;
    
    # åº”ç”¨è¿æ¥å’Œè¯·æ±‚é™åˆ¶
    limit_conn conn_limit_per_ip 10;
    limit_req zone=req_limit_per_ip burst=10 nodelay;
    
    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~* \.(sql|log|conf|bak|backup|swp|tmp)$ {
        deny all;
    }
    
    # ç¦æ­¢è®¿é—®ç‰¹å®šç›®å½•
    location ~ ^/(config|backup|temp) {
        deny all;
    }
}
```

### 6.2 MySQLå®‰å…¨é…ç½®

```bash
# è¿è¡Œå®‰å…¨åˆå§‹åŒ–è„šæœ¬
sudo mysql_secure_installation
# æŒ‰æç¤ºæ“ä½œï¼š
# - è®¾ç½®rootå¯†ç 
# - åˆ é™¤åŒ¿åç”¨æˆ·
# - ç¦æ­¢rootè¿œç¨‹ç™»å½•
# - åˆ é™¤testæ•°æ®åº“
# - é‡è½½æƒé™è¡¨
```

**MySQLé…ç½®æ–‡ä»¶åŠ å›ºï¼š**

```ini
# /etc/mysql/mysql.conf.d/mysqld.cnf
[mysqld]
# ç»‘å®šæœ¬åœ°åœ°å€
bind-address = 127.0.0.1

# ç¦ç”¨è¿œç¨‹è®¿é—®ï¼ˆå¦‚ä¸éœ€è¦ï¼‰
skip-networking

# æ—¥å¿—é…ç½®
log-error = /var/log/mysql/error.log
general_log = 1
general_log_file = /var/log/mysql/mysql.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 2

# å®‰å…¨è®¾ç½®
local-infile = 0
secure-file-priv = /var/lib/mysql-files/

# ç¦ç”¨ç¬¦å·é“¾æ¥
symbolic-links = 0

# è®¾ç½®æœ€å¤§è¿æ¥æ•°
max_connections = 100
```

**åˆ›å»ºåº”ç”¨ä¸“ç”¨æ•°æ®åº“ç”¨æˆ·ï¼š**

```sql
-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'StrongPassword123!@#';

-- æˆäºˆæœ€å°æƒé™
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp_db.* TO 'appuser'@'localhost';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- åˆ é™¤å±é™©çš„é»˜è®¤ç”¨æˆ·
DROP USER ''@'localhost';
DROP USER ''@'%';
DROP DATABASE IF EXISTS test;
```

### 6.3 Rediså®‰å…¨é…ç½®

```bash
# ç¼–è¾‘Redisé…ç½®
sudo vim /etc/redis/redis.conf
```

```conf
# ç»‘å®šæœ¬åœ°åœ°å€
bind 127.0.0.1

# è®¾ç½®å¼ºå¯†ç 
requirepass YourVeryStrongRedisPassword!@#$%

# ç¦ç”¨å±é™©å‘½ä»¤
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_a1b2c3d4e5f6"
rename-command SHUTDOWN "SHUTDOWN_a1b2c3d4e5f6"

# ä¿æŠ¤æ¨¡å¼
protected-mode yes

# å†…å­˜é™åˆ¶
maxmemory 256mb
maxmemory-policy allkeys-lru

# æ—¥å¿—é…ç½®
loglevel notice
logfile /var/log/redis/redis-server.log

# æŒä¹…åŒ–é…ç½®
appendonly yes
appendfsync everysec
```

---

## ä¸ƒã€ç›‘æ§å’Œæ—¥å¿—ç®¡ç†

### 7.1 ç³»ç»Ÿç›‘æ§å·¥å…·

```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install htop iotop nethogs sysstat -y

# å¯ç”¨ç³»ç»Ÿç»Ÿè®¡
sudo systemctl enable sysstat
sudo systemctl start sysstat

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop            # è¿›ç¨‹ç›‘æ§
iotop           # IOç›‘æ§
nethogs         # ç½‘ç»œæµé‡ç›‘æ§
sar -u 1 10     # CPUä½¿ç”¨ç‡
sar -r 1 10     # å†…å­˜ä½¿ç”¨ç‡
iostat -x 1 10  # ç£ç›˜IO
```

### 7.2 æ—¥å¿—ç®¡ç†

#### é…ç½®rsyslogé›†ä¸­æ—¥å¿—

```bash
# ç¼–è¾‘rsyslogé…ç½®
sudo vim /etc/rsyslog.conf

# æ·»åŠ è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰
*.* @@remote-log-server:514

# é‡å¯rsyslog
sudo systemctl restart rsyslog
```

#### æ—¥å¿—è½®è½¬é…ç½®

```bash
# åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/custom-logs
```

```conf
/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0644 www-data adm
    sharedscripts
    postrotate
        systemctl reload nginx > /dev/null
    endscript
}

/var/log/mysql/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0640 mysql mysql
    sharedscripts
    postrotate
        systemctl reload mysql > /dev/null
    endscript
}

/var/log/redis/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 redis redis
    postrotate
        systemctl reload redis-server > /dev/null
    endscript
}
```

#### æ—¥å¿—ç›‘æ§å·¥å…· - Logwatch

```bash
# å®‰è£…Logwatch
sudo apt install logwatch -y

# é…ç½®Logwatch
sudo vim /etc/logwatch/conf/logwatch.conf
```

```conf
Output = mail
Format = html
MailTo = admin@yourdomain.com
MailFrom = logwatch@yourdomain.com
Range = yesterday
Detail = High
Service = All
```

### 7.3 ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# /usr/local/bin/security_monitor.sh

echo "=== æœåŠ¡å™¨å®‰å…¨ç›‘æ§æŠ¥å‘Š ==="
echo "æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
echo "============================="

# æ£€æŸ¥å¼‚å¸¸ç™»å½•
echo -e "\n[1] æœ€è¿‘ç™»å½•è®°å½•:"
last | head -10

# æ£€æŸ¥å¤±è´¥ç™»å½•
echo -e "\n[2] å¤±è´¥ç™»å½•å°è¯•:"
grep "Failed password" /var/log/auth.log | tail -5

# æ£€æŸ¥ç½‘ç»œè¿æ¥
echo -e "\n[3] æ´»åŠ¨ç½‘ç»œè¿æ¥:"
ss -tunap | grep ESTABLISHED | head -10

# æ£€æŸ¥ç›‘å¬ç«¯å£
echo -e "\n[4] ç›‘å¬ç«¯å£:"
ss -tulpn | grep LISTEN

# æ£€æŸ¥è¿›ç¨‹
echo -e "\n[5] å…³é”®è¿›ç¨‹çŠ¶æ€:"
ps aux | grep -E '(nginx|mysql|redis)' | grep -v grep

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
echo -e "\n[6] ç£ç›˜ä½¿ç”¨æƒ…å†µ:"
df -h | grep -E '(Filesystem|/dev/)'

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
echo -e "\n[7] å†…å­˜ä½¿ç”¨:"
free -h

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
echo -e "\n[8] ç³»ç»Ÿè´Ÿè½½:"
uptime

# æ£€æŸ¥æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶
echo -e "\n[9] æœ€è¿‘24å°æ—¶ä¿®æ”¹çš„ç³»ç»Ÿæ–‡ä»¶:"
find /etc -type f -mtime -1 2>/dev/null

# æ£€æŸ¥å®šæ—¶ä»»åŠ¡
echo -e "\n[10] Crontabä»»åŠ¡:"
crontab -l

echo -e "\n=== ç›‘æ§å®Œæˆ ==="
```

è®¾ç½®å®šæ—¶æ‰§è¡Œï¼š
```bash
# æ·»åŠ å¯æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/security_monitor.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å°æ—¶æ‰§è¡Œï¼‰
echo "0 * * * * /usr/local/bin/security_monitor.sh | mail -s 'Security Monitor Report' admin@yourdomain.com" | sudo crontab -
```


---

## å…«ã€å¤‡ä»½å’Œæ¢å¤

### 8.1 è‡ªåŠ¨å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
# /usr/local/bin/backup.sh

# é…ç½®å˜é‡
BACKUP_DIR="/backup"
DATE=$(date +%Y%m%d_%H%M%S)
MYSQL_USER="backup_user"
MYSQL_PASS="your_password"
RETENTION_DAYS=7

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR/$DATE

echo "å¼€å§‹å¤‡ä»½: $(date)"

# å¤‡ä»½MySQLæ•°æ®åº“
echo "å¤‡ä»½MySQLæ•°æ®åº“..."
mysqldump -u$MYSQL_USER -p$MYSQL_PASS --all-databases --single-transaction --quick --lock-tables=false > $BACKUP_DIR/$DATE/mysql_all_databases.sql 2>/dev/null
if [ $? -eq 0 ]; then
    gzip $BACKUP_DIR/$DATE/mysql_all_databases.sql
    echo "MySQLå¤‡ä»½å®Œæˆ"
else
    echo "MySQLå¤‡ä»½å¤±è´¥"
fi

# å¤‡ä»½Webæ–‡ä»¶
echo "å¤‡ä»½Webæ–‡ä»¶..."
tar -czf $BACKUP_DIR/$DATE/web_files.tar.gz /var/www/html 2>/dev/null
echo "Webæ–‡ä»¶å¤‡ä»½å®Œæˆ"

# å¤‡ä»½é…ç½®æ–‡ä»¶
echo "å¤‡ä»½é…ç½®æ–‡ä»¶..."
tar -czf $BACKUP_DIR/$DATE/configs.tar.gz /etc/nginx /etc/mysql /etc/redis /etc/ssh 2>/dev/null
echo "é…ç½®æ–‡ä»¶å¤‡ä»½å®Œæˆ"

# å¤‡ä»½ç”¨æˆ·æ•°æ®
echo "å¤‡ä»½ç”¨æˆ·æ•°æ®..."
tar -czf $BACKUP_DIR/$DATE/home_dirs.tar.gz /home 2>/dev/null
echo "ç”¨æˆ·æ•°æ®å¤‡ä»½å®Œæˆ"

# åˆ é™¤æ—§å¤‡ä»½
echo "æ¸…ç†æ—§å¤‡ä»½..."
find $BACKUP_DIR -type d -mtime +$RETENTION_DAYS -exec rm -rf {} + 2>/dev/null

# ç”Ÿæˆå¤‡ä»½æŠ¥å‘Š
BACKUP_SIZE=$(du -sh $BACKUP_DIR/$DATE | cut -f1)
echo -e "\n=== å¤‡ä»½å®Œæˆ ===\nå¤‡ä»½æ—¶é—´: $DATE\nå¤‡ä»½å¤§å°: $BACKUP_SIZE\nå¤‡ä»½ä½ç½®: $BACKUP_DIR/$DATE" | \
mail -s "æœåŠ¡å™¨å¤‡ä»½å®Œæˆ - $DATE" admin@yourdomain.com

echo "å¤‡ä»½å®Œæˆ: $(date)"
```

è®¾ç½®å®šæ—¶å¤‡ä»½ï¼š
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œï¼‰
sudo crontab -e
# æ·»åŠ ï¼š
0 2 * * * /usr/local/bin/backup.sh >> /var/log/backup.log 2>&1
```

### 8.2 äº‘å¹³å°å¿«ç…§ç­–ç•¥

#### é˜¿é‡Œäº‘ECSå¿«ç…§

```bash
# ä½¿ç”¨é˜¿é‡Œäº‘CLIåˆ›å»ºå¿«ç…§ï¼ˆéœ€å…ˆå®‰è£…aliyun-cliï¼‰
aliyun ecs CreateSnapshot --DiskId d-bp1xxx --SnapshotName "daily-backup-$(date +%Y%m%d)"

# è®¾ç½®è‡ªåŠ¨å¿«ç…§ç­–ç•¥
# åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ï¼š
# 1. è¿›å…¥ECS â†’ å­˜å‚¨ä¸å¿«ç…§ â†’ è‡ªåŠ¨å¿«ç…§ç­–ç•¥
# 2. åˆ›å»ºç­–ç•¥ï¼šæ¯æ—¥å‡Œæ™¨æ‰§è¡Œï¼Œä¿ç•™7å¤©
# 3. åº”ç”¨åˆ°ç›®æ ‡ç£ç›˜
```

#### è…¾è®¯äº‘CBSå¿«ç…§

```bash
# åœ¨è…¾è®¯äº‘æ§åˆ¶å°æ“ä½œï¼š
# 1. äº‘ç¡¬ç›˜ â†’ å¿«ç…§åˆ—è¡¨ â†’ å®šæœŸå¿«ç…§ç­–ç•¥
# 2. åˆ›å»ºç­–ç•¥ï¼š
#    - å¤‡ä»½é¢‘ç‡ï¼šæ¯æ—¥
#    - å¤‡ä»½æ—¶é—´ï¼šå‡Œæ™¨2:00
#    - ä¿ç•™æ—¶é—´ï¼š7å¤©
# 3. å…³è”åˆ°äº‘ç¡¬ç›˜
```

### 8.3 å¼‚åœ°å¤‡ä»½ç­–ç•¥

```bash
# ä½¿ç”¨rcloneåŒæ­¥åˆ°å¯¹è±¡å­˜å‚¨
# å®‰è£…rclone
curl https://rclone.org/install.sh | sudo bash

# é…ç½®rcloneï¼ˆä»¥é˜¿é‡Œäº‘OSSä¸ºä¾‹ï¼‰
rclone config

# å¤‡ä»½åˆ°OSS
rclone sync /backup aliyun-oss:my-backup-bucket --progress

# æ·»åŠ åˆ°å¤‡ä»½è„šæœ¬
echo "rclone sync /backup aliyun-oss:my-backup-bucket --progress" >> /usr/local/bin/backup.sh
```

---

## ä¹ã€åº”æ€¥å“åº”

### 9.1 å…¥ä¾µæ£€æµ‹æ¸…å•

```bash
#!/bin/bash
# å…¥ä¾µæ£€æµ‹è„šæœ¬

echo "=== å…¥ä¾µæ£€æµ‹æ£€æŸ¥ ==="

# 1. æ£€æŸ¥å½“å‰ç™»å½•ç”¨æˆ·
echo -e "\n[1] å½“å‰ç™»å½•ç”¨æˆ·:"
who
w

# 2. æ£€æŸ¥æœ€è¿‘ç™»å½•
echo -e "\n[2] æœ€è¿‘ç™»å½•è®°å½•:"
last | head -20

# 3. æ£€æŸ¥å¤±è´¥ç™»å½•
echo -e "\n[3] å¤±è´¥ç™»å½•å°è¯•:"
lastb | head -20

# 4. æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹
echo -e "\n[4] å¯ç–‘è¿›ç¨‹:"
ps aux | grep -E 'bash|sh|nc|ncat|python|perl|ruby|wget|curl' | grep -v grep

# 5. æ£€æŸ¥ç½‘ç»œè¿æ¥
echo -e "\n[5] ç½‘ç»œè¿æ¥:"
netstat -tuln
ss -tunap | grep ESTABLISHED

# 6. æ£€æŸ¥ç›‘å¬ç«¯å£
echo -e "\n[6] ç›‘å¬ç«¯å£:"
lsof -i -P -n | grep LISTEN

# 7. æ£€æŸ¥æ–‡ä»¶ä¿®æ”¹
echo -e "\n[7] æœ€è¿‘24å°æ—¶ä¿®æ”¹çš„/etcæ–‡ä»¶:"
find /etc -type f -mtime -1 2>/dev/null

echo -e "\n[8] æœ€è¿‘24å°æ—¶ä¿®æ”¹çš„/var/wwwæ–‡ä»¶:"
find /var/www -type f -mtime -1 2>/dev/null

# 9. æ£€æŸ¥crontab
echo -e "\n[9] Crontabä»»åŠ¡:"
crontab -l
sudo crontab -l
ls -la /etc/cron*

# 10. æ£€æŸ¥å¯åŠ¨é¡¹
echo -e "\n[10] å¯åŠ¨æœåŠ¡:"
systemctl list-unit-files --type=service --state=enabled

# 11. æ£€æŸ¥SSHå¯†é’¥
echo -e "\n[11] SSHæˆæƒå¯†é’¥:"
cat ~/.ssh/authorized_keys
sudo cat /root/.ssh/authorized_keys

# 12. æ£€æŸ¥ç³»ç»Ÿç”¨æˆ·
echo -e "\n[12] ç³»ç»Ÿç”¨æˆ·:"
cat /etc/passwd | grep -E "bash|sh"

# 13. æ£€æŸ¥sudoæƒé™
echo -e "\n[13] Sudoæƒé™ç”¨æˆ·:"
grep -Po '^\K[^:]*(?=.*sudo)' /etc/group

# 14. æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
echo -e "\n[14] ç³»ç»Ÿæ–‡ä»¶å®Œæ•´æ€§:"
sudo debsums -c | head -20

# 15. æ£€æŸ¥rootkit
echo -e "\n[15] Rootkitæ£€æµ‹:"
sudo rkhunter --check --skip-keypress | grep Warning
```

### 9.2 åº”æ€¥å¤„ç†æ­¥éª¤

#### æ­¥éª¤1ï¼šéš”ç¦»ç³»ç»Ÿ

```bash
# âš ï¸ è°¨æ…æ“ä½œï¼šæ–­å¼€ç½‘ç»œè¿æ¥
# æ–¹æ³•1ï¼šç¦ç”¨ç½‘å¡
sudo ifconfig eth0 down

# æ–¹æ³•2ï¼šé˜²ç«å¢™é˜»æ–­
sudo iptables -P INPUT DROP
sudo iptables -P OUTPUT DROP

# æ–¹æ³•3ï¼šåœ¨äº‘æ§åˆ¶å°è§£ç»‘å…¬ç½‘IP
```

#### æ­¥éª¤2ï¼šä¿å­˜è¯æ®

```bash
# ä¿å­˜å†…å­˜ä¿¡æ¯
sudo dd if=/dev/mem of=/tmp/memory.dump bs=1M

# ä¿å­˜ç½‘ç»œè¿æ¥
sudo netstat -tulanp > /tmp/network_connections.txt
sudo ss -tunap > /tmp/socket_stats.txt

# ä¿å­˜è¿›ç¨‹åˆ—è¡¨
ps auxf > /tmp/process_list.txt

# ä¿å­˜ç™»å½•å†å²
last > /tmp/last_logins.txt
lastb > /tmp/failed_logins.txt

# ä¿å­˜ç³»ç»Ÿæ—¥å¿—
sudo tar -czf /tmp/system_logs.tar.gz /var/log

# å¤åˆ¶åˆ°å®‰å…¨ä½ç½®
sudo mkdir -p /evidence
sudo mv /tmp/*.txt /tmp/*.dump /tmp/*.tar.gz /evidence/
```

#### æ­¥éª¤3ï¼šåˆ†æå’Œæ¸…ç†

```bash
# åˆ†æå…¥ä¾µè·¯å¾„
sudo grep -r "Failed password" /var/log/auth.log
sudo grep -r "Accepted publickey" /var/log/auth.log

# æŸ¥æ‰¾æ¶æ„æ–‡ä»¶
sudo find / -name "*.php" -mtime -7
sudo find / -name "*.sh" -mtime -7
sudo find / -perm -4000 -ls  # æŸ¥æ‰¾SUIDæ–‡ä»¶

# æ£€æŸ¥åé—¨
sudo rkhunter --check
sudo chkrootkit

# æ¸…ç†æ¶æ„è¿›ç¨‹
ps aux | grep suspicious_process
sudo kill -9 PID

# æ¸…ç†å®šæ—¶ä»»åŠ¡
crontab -r
sudo crontab -r

# æ¸…ç†SSHå¯†é’¥
rm ~/.ssh/authorized_keys
sudo rm /root/.ssh/authorized_keys
```

#### æ­¥éª¤4ï¼šç³»ç»Ÿæ¢å¤

```bash
# ä»å¤‡ä»½æ¢å¤
sudo tar -xzf /backup/latest/configs.tar.gz -C /

# é‡è£…ç³»ç»Ÿï¼ˆå¿…è¦æ—¶ï¼‰
# 1. åœ¨äº‘æ§åˆ¶å°åˆ›å»ºå¿«ç…§
# 2. ä½¿ç”¨é•œåƒé‡æ–°åˆå§‹åŒ–ç³»ç»Ÿ
# 3. ä»å¤‡ä»½æ¢å¤æ•°æ®

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# ä¿®æ”¹æ‰€æœ‰å¯†ç 
sudo passwd
sudo passwd deploy

# é‡æ–°ç”ŸæˆSSHå¯†é’¥
ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519

# é‡å¯æœåŠ¡
sudo systemctl restart sshd nginx mysql redis
```

---

## åã€äº‘å¹³å°å®‰å…¨æœåŠ¡

### 10.1 é˜¿é‡Œäº‘å®‰å…¨äº§å“

#### äº‘å®‰å…¨ä¸­å¿ƒï¼ˆå®‰éª‘å£«ï¼‰

```bash
# åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼š
# 1. äº‘å®‰å…¨ä¸­å¿ƒ â†’ åŸºçº¿æ£€æŸ¥
# 2. å¼€å¯"Linuxæ“ä½œç³»ç»Ÿå®‰å…¨åŸºçº¿"
# 3. è®¾ç½®è‡ªåŠ¨ä¿®å¤ç­–ç•¥
# 4. é…ç½®å‘Šè­¦é€šçŸ¥

# ä¸»è¦åŠŸèƒ½ï¼š
# - æ¼æ´æ£€æµ‹ä¸ä¿®å¤
# - åŸºçº¿æ£€æŸ¥ï¼ˆCIS/ç­‰ä¿2.0ï¼‰
# - å…¥ä¾µæ£€æµ‹
# - ç—…æ¯’æŸ¥æ€
# - ç½‘é¡µé˜²ç¯¡æ”¹
```

#### Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰

```nginx
# åœ¨åº”ç”¨å±‚é¢é…ç½®WAF
# åŠŸèƒ½ï¼š
# - SQLæ³¨å…¥é˜²æŠ¤
# - XSSæ”»å‡»é˜²æŠ¤
# - Web Shellä¸Šä¼ é˜²æŠ¤
# - CCæ”»å‡»é˜²æŠ¤
# - 0dayæ¼æ´è™šæ‹Ÿè¡¥ä¸
```

#### DDoSé˜²æŠ¤

```bash
# åŸºç¡€é˜²æŠ¤ï¼šå…è´¹æä¾›
# - æœ€é«˜5Gbpsé˜²æŠ¤èƒ½åŠ›
# - è‡ªåŠ¨å¯ç”¨

# é«˜çº§é˜²æŠ¤ï¼šæŒ‰éœ€è´­ä¹°
# - 100Gbps+é˜²æŠ¤èƒ½åŠ›
# - è‡ªå®šä¹‰é˜²æŠ¤ç­–ç•¥
```

### 10.2 è…¾è®¯äº‘å®‰å…¨äº§å“

#### ä¸»æœºå®‰å…¨ï¼ˆäº‘é•œï¼‰

```bash
# å®‰è£…ä¸»æœºå®‰å…¨å®¢æˆ·ç«¯
wget https://mirrors.tencent.com/install/sec/agent_linux64.tar.gz
tar -xzvf agent_linux64.tar.gz
sudo ./agent_install.sh

# ä¸»è¦åŠŸèƒ½ï¼š
# - æœ¨é©¬ç—…æ¯’æ£€æµ‹
# - å¼‚å¸¸ç™»å½•æ£€æµ‹
# - å¯†ç ç ´è§£é˜²æŠ¤
# - æ¶æ„è¯·æ±‚æ£€æµ‹
# - é«˜å±æ¼æ´æ£€æµ‹
```

#### äº‘é˜²ç«å¢™

```bash
# åœ¨è…¾è®¯äº‘æ§åˆ¶å°é…ç½®
# åŠŸèƒ½ï¼š
# - å—åŒ—å‘æµé‡æ§åˆ¶
# - å…¥ä¾µé˜²å¾¡
# - è®¿é—®æ§åˆ¶ç­–ç•¥
# - æµé‡å¯è§†åŒ–
# - å®‰å…¨äº‹ä»¶å‘Šè­¦
```

---

## åä¸€ã€å®‰å…¨å®¡è®¡å·¥å…·

### 11.1 Lyniså®‰å…¨å®¡è®¡

```bash
# å®‰è£…Lynis
sudo apt install lynis -y

# è¿è¡Œå®Œæ•´ç³»ç»Ÿå®¡è®¡
sudo lynis audit system

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
sudo cat /var/log/lynis.log

# æŸ¥çœ‹å»ºè®®
sudo lynis show suggestions

# è‡ªåŠ¨åŒ–å®¡è®¡
echo "0 3 * * 1 lynis audit system > /var/log/lynis-$(date +\%Y\%m\%d).log" | sudo crontab -
```

### 11.2 ClamAVç—…æ¯’æ‰«æ

```bash
# å®‰è£…ClamAV
sudo apt install clamav clamav-daemon -y

# æ›´æ–°ç—…æ¯’åº“
sudo freshclam

# æ‰‹åŠ¨æ‰«æ
sudo clamscan -r /home /var/www

# è‡ªåŠ¨æ‰«æè„šæœ¬
cat > /usr/local/bin/virus-scan.sh << 'EOF'
#!/bin/bash
SCAN_DIR="/home /var/www"
LOG_FILE="/var/log/clamav/scan-$(date +%Y%m%d).log"

clamscan -r --infected --remove=yes $SCAN_DIR > $LOG_FILE 2>&1

# å‘é€æŠ¥å‘Š
if grep "Infected files:" $LOG_FILE | grep -v ": 0"; then
    mail -s "ç—…æ¯’æ‰«æå‘Šè­¦" admin@yourdomain.com < $LOG_FILE
fi
EOF

chmod +x /usr/local/bin/virus-scan.sh

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹ï¼‰
echo "0 3 * * 0 /usr/local/bin/virus-scan.sh" | sudo crontab -
```

---

## åäºŒã€å®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å•

### 12.1 æ¯æ—¥æ£€æŸ¥

| é¡¹ç›® | å‘½ä»¤ | æ£€æŸ¥å†…å®¹ |
|------|------|----------|
| ç™»å½•æ—¥å¿— | `sudo tail -50 /var/log/auth.log` | å¼‚å¸¸ç™»å½•å°è¯• |
| å¤±è´¥ç™»å½• | `sudo grep "Failed password" /var/log/auth.log \| tail -10` | æš´åŠ›ç ´è§£æ”»å‡» |
| ç³»ç»Ÿè´Ÿè½½ | `uptime` | CPUè´Ÿè½½æ˜¯å¦æ­£å¸¸ |
| ç£ç›˜ç©ºé—´ | `df -h` | ç£ç›˜ä½¿ç”¨ç‡ |
| æœåŠ¡çŠ¶æ€ | `systemctl status nginx mysql redis ssh` | å…³é”®æœåŠ¡è¿è¡ŒçŠ¶æ€ |
| ç½‘ç»œè¿æ¥ | `ss -tunap \| grep ESTABLISHED` | å¼‚å¸¸ç½‘ç»œè¿æ¥ |

### 12.2 æ¯å‘¨æ£€æŸ¥

| é¡¹ç›® | å‘½ä»¤ | æ£€æŸ¥å†…å®¹ |
|------|------|----------|
| ç³»ç»Ÿæ›´æ–° | `sudo apt list --upgradable` | å¯ç”¨å®‰å…¨æ›´æ–° |
| ç”¨æˆ·è´¦æˆ· | `cut -d: -f1 /etc/passwd` | æœªæˆæƒç”¨æˆ·è´¦æˆ· |
| Sudoæƒé™ | `grep sudo /etc/group` | Sudoæƒé™åˆ†é… |
| å¼€æ”¾ç«¯å£ | `sudo ss -tulpn` | æœªæˆæƒå¼€æ”¾ç«¯å£ |
| æ–‡ä»¶æƒé™ | `ls -la /etc/passwd /etc/shadow /etc/ssh/sshd_config` | æ•æ„Ÿæ–‡ä»¶æƒé™ |
| Crontab | `crontab -l; sudo crontab -l` | å¯ç–‘å®šæ—¶ä»»åŠ¡ |
| å¤‡ä»½éªŒè¯ | `ls -lh /backup` | å¤‡ä»½å®Œæ•´æ€§ |

### 12.3 æ¯æœˆæ£€æŸ¥

| é¡¹ç›® | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| å®‰å…¨å®¡è®¡ | `sudo lynis audit system` | å®Œæ•´ç³»ç»Ÿå®‰å…¨å®¡è®¡ |
| ç—…æ¯’æ‰«æ | `sudo clamscan -r /` | å…¨ç›˜ç—…æ¯’æ‰«æ |
| å¯†ç æ›´æ–° | `sudo passwd` | æ›´æ¢å…³é”®è´¦æˆ·å¯†ç  |
| SSHå¯†é’¥è½®æ¢ | é‡æ–°ç”ŸæˆSSHå¯†é’¥ | å®šæœŸæ›´æ¢è®¿é—®å¯†é’¥ |
| æ—¥å¿—å®¡æŸ¥ | å®¡æŸ¥ç³»ç»Ÿæ—¥å¿— | æŸ¥æ‰¾å¼‚å¸¸æ¨¡å¼ |
| å®‰å…¨ç»„å®¡è®¡ | æ£€æŸ¥äº‘å¹³å°å®‰å…¨ç»„ | ç§»é™¤ä¸å¿…è¦çš„è§„åˆ™ |
| å¿«ç…§éªŒè¯ | æµ‹è¯•å¿«ç…§æ¢å¤ | éªŒè¯å¤‡ä»½å¯ç”¨æ€§ |

---

## åä¸‰ã€å®‰å…¨åŠ å›ºä¼˜å…ˆçº§

### ğŸ”¥ ç«‹å³æ‰§è¡Œï¼ˆP0 - é«˜å±ï¼‰

1. âœ… **SSHå¯†é’¥è®¤è¯** - ç¦ç”¨å¯†ç ç™»å½•
2. âœ… **ç¦ç”¨rootç›´æ¥ç™»å½•** - åˆ›å»ºæ™®é€šç®¡ç†ç”¨æˆ·
3. âœ… **å®‰å…¨ç»„é™åˆ¶** - SSHç«¯å£ä»…å…è®¸è¿ç»´IP
4. âœ… **ä¿®æ”¹SSHé»˜è®¤ç«¯å£** - ä»22æ”¹ä¸ºè‡ªå®šä¹‰ç«¯å£
5. âœ… **ç³»ç»Ÿæ›´æ–°** - å®‰è£…æœ€æ–°å®‰å…¨è¡¥ä¸

### ğŸ“… æœ¬å‘¨å†…å®Œæˆï¼ˆP1 - ä¸­å±ï¼‰

1. â˜‘ï¸ **é…ç½®UFW/firewalld** - å¯ç”¨æœ¬åœ°é˜²ç«å¢™
2. â˜‘ï¸ **å®‰è£…Fail2Ban** - é˜²æ­¢æš´åŠ›ç ´è§£
3. â˜‘ï¸ **é…ç½®è‡ªåŠ¨å¤‡ä»½** - è®¾ç½®æ¯æ—¥å¤‡ä»½è®¡åˆ’
4. â˜‘ï¸ **åº”ç”¨å®‰å…¨åŠ å›º** - Nginx/MySQL/Redisé…ç½®ä¼˜åŒ–
5. â˜‘ï¸ **å¯ç”¨SELinux/AppArmor** - å¼ºåˆ¶è®¿é—®æ§åˆ¶

### ğŸ”„ æŒç»­ç»´æŠ¤ï¼ˆP2 - ä½å±ï¼‰

1. ğŸ“Š **æ—¥å¿—ç›‘æ§** - é…ç½®logwatch/rsyslog
2. ğŸ“Š **å®šæœŸå®‰å…¨æ£€æŸ¥** - æ¯å‘¨è¿è¡Œå®‰å…¨å®¡è®¡è„šæœ¬
3. ğŸ“Š **æƒé™å®¡è®¡** - æ¯æœˆæ£€æŸ¥ç”¨æˆ·æƒé™
4. ğŸ“Š **æ€§èƒ½ç›‘æ§** - ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
5. ğŸ“Š **å®‰å…¨åŸ¹è®­** - å›¢é˜Ÿå®‰å…¨æ„è¯†æå‡

---

## åå››ã€å®‰å…¨å·¥å…·æ±‡æ€»

### 14.1 å¿…å¤‡å·¥å…·

| å·¥å…· | ç±»åˆ« | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|------|------|------|----------|
| **Fail2Ban** | å…¥ä¾µé˜²å¾¡ | é˜²æš´åŠ›ç ´è§£ | `sudo apt install fail2ban` |
| **UFW/firewalld** | é˜²ç«å¢™ | ç½‘ç»œè®¿é—®æ§åˆ¶ | `sudo apt install ufw` |
| **AIDE** | æ–‡ä»¶å®Œæ•´æ€§ | æ£€æµ‹æ–‡ä»¶ç¯¡æ”¹ | `sudo apt install aide` |
| **OSSEC** | å…¥ä¾µæ£€æµ‹ | å®æ—¶ç›‘æ§ | æºç ç¼–è¯‘å®‰è£… |
| **Lynis** | å®‰å…¨å®¡è®¡ | ç³»ç»Ÿå®‰å…¨è¯„ä¼° | `sudo apt install lynis` |
| **ClamAV** | åç—…æ¯’ | ç—…æ¯’æ‰«æ | `sudo apt install clamav` |
| **rkhunter** | Rootkitæ£€æµ‹ | åé—¨æ£€æµ‹ | `sudo apt install rkhunter` |
| **logwatch** | æ—¥å¿—åˆ†æ | æ—¥å¿—ç›‘æ§æŠ¥å‘Š | `sudo apt install logwatch` |

### 14.2 æ¨èå·¥å…·

| å·¥å…· | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **htop** | è¿›ç¨‹ç›‘æ§ | å¢å¼ºç‰ˆtop |
| **iotop** | IOç›‘æ§ | ç£ç›˜IOç›‘æ§ |
| **nethogs** | ç½‘ç»œç›‘æ§ | æŒ‰è¿›ç¨‹ç›‘æ§ç½‘ç»œæµé‡ |
| **tcpdump** | ç½‘ç»œæŠ“åŒ… | æµé‡åˆ†æ |
| **nmap** | ç«¯å£æ‰«æ | å®‰å…¨æ‰«æ |
| **docker-bench-security** | Dockerå®‰å…¨ | Dockerå®‰å…¨æ£€æŸ¥ |

---

## åäº”ã€å¸¸è§æ”»å‡»é˜²æŠ¤

### 15.1 SSHæš´åŠ›ç ´è§£é˜²æŠ¤

**é˜²æŠ¤æªæ–½ï¼š**
1. ä½¿ç”¨å¯†é’¥è®¤è¯ï¼Œç¦ç”¨å¯†ç 
2. ä¿®æ”¹é»˜è®¤ç«¯å£
3. ä½¿ç”¨Fail2Banè‡ªåŠ¨å°ç¦
4. é™åˆ¶ç™»å½•IPç™½åå•
5. ä½¿ç”¨Google Authenticatorï¼ˆ2FAï¼‰

### 15.2 DDoSæ”»å‡»é˜²æŠ¤

**é˜²æŠ¤æªæ–½ï¼š**
1. å¯ç”¨äº‘å¹³å°DDoSé˜²æŠ¤
2. é…ç½®SYN Cookies
3. é™åˆ¶è¿æ¥é€Ÿç‡
4. ä½¿ç”¨CDNæœåŠ¡
5. é…ç½®é˜²ç«å¢™è§„åˆ™

### 15.3 SQLæ³¨å…¥é˜²æŠ¤

**é˜²æŠ¤æªæ–½ï¼š**
1. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
2. è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
3. æœ€å°æƒé™åŸåˆ™
4. ä½¿ç”¨WAF
5. å®šæœŸå®‰å…¨å®¡è®¡

### 15.4 XSSæ”»å‡»é˜²æŠ¤

**é˜²æŠ¤æªæ–½ï¼š**
1. è¾“å‡ºç¼–ç 
2. è®¾ç½®CSPå¤´
3. ä½¿ç”¨å®‰å…¨çš„JSæ¡†æ¶
4. è¾“å…¥éªŒè¯
5. HttpOnly Cookie

---

## åå…­ã€åº”æ€¥å“åº”æ¼”ç»ƒ

### 16.1 æ¼”ç»ƒåœºæ™¯

#### åœºæ™¯1ï¼šå‘ç°å¼‚å¸¸ç™»å½•

```bash
# 1. ç«‹å³æ£€æŸ¥
who
last | head -20

# 2. é”å®šå¯ç–‘ç”¨æˆ·
sudo usermod -L suspicious_user

# 3. ç»ˆæ­¢ä¼šè¯
sudo pkill -u suspicious_user

# 4. å®¡æŸ¥æ—¥å¿—
sudo grep suspicious_user /var/log/auth.log

# 5. ä¿®æ”¹å¯†ç 
sudo passwd suspicious_user

# 6. æ£€æŸ¥æˆæƒå¯†é’¥
sudo cat /home/suspicious_user/.ssh/authorized_keys
```

#### åœºæ™¯2ï¼šå‘ç°æ¶æ„è¿›ç¨‹

```bash
# 1. è¯†åˆ«è¿›ç¨‹
ps aux | grep suspicious

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
sudo lsof -p PID

# 3. ç»ˆæ­¢è¿›ç¨‹
sudo kill -9 PID

# 4. æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶
sudo ls -la /proc/PID/exe

# 5. åˆ é™¤æ¶æ„æ–‡ä»¶
sudo rm -f /path/to/malicious/file

# 6. æ£€æŸ¥å®šæ—¶ä»»åŠ¡
crontab -l
sudo crontab -l
```

### 16.2 æ¼”ç»ƒæ¸…å•

- [ ] å¼‚å¸¸ç™»å½•æ£€æµ‹å’Œå“åº”
- [ ] æ¶æ„è¿›ç¨‹å‘ç°å’Œæ¸…ç†
- [ ] ä»å¤‡ä»½æ¢å¤æ•°æ®
- [ ] ç´§æ€¥éš”ç¦»æœåŠ¡å™¨
- [ ] å®‰å…¨äº‹ä»¶æŠ¥å‘Šæµç¨‹
- [ ] å›¢é˜Ÿæ²Ÿé€šå’Œåä½œ
- [ ] ç³»ç»Ÿé‡å»ºå’ŒåŠ å›º

---

## åä¸ƒã€æ€»ç»“

### 17.1 å®‰å…¨åŠ å›ºæ ¸å¿ƒè¦ç‚¹

1. **åˆ†å±‚é˜²å¾¡**ï¼šç½‘ç»œâ†’ç³»ç»Ÿâ†’åº”ç”¨â†’æ•°æ®ï¼Œæ¯å±‚éƒ½æœ‰é˜²æŠ¤
2. **æœ€å°æƒé™**ï¼šåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™
3. **æŒç»­ç›‘æ§**ï¼šå®æ—¶ç›‘æ§+å®šæœŸå®¡è®¡
4. **è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨æ›´æ–°ã€è‡ªåŠ¨å¤‡ä»½ã€è‡ªåŠ¨å‘Šè­¦
5. **å¿«é€Ÿå“åº”**ï¼šæœ‰å®Œå–„çš„åº”æ€¥é¢„æ¡ˆ

### 17.2 å®‰å…¨åŸºçº¿æ£€æŸ¥è¡¨

- [x] ç³»ç»Ÿå’Œè½¯ä»¶å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- [x] å·²åˆ›å»ºérootç”¨æˆ·å¹¶ç¦ç”¨rootè¿œç¨‹ç™»å½•
- [x] SSHå·²é…ç½®å¯†é’¥è®¤è¯å¹¶æ›´æ”¹é»˜è®¤ç«¯å£
- [x] é˜²ç«å¢™å·²æ­£ç¡®é…ç½®ï¼ˆUFW/firewalldï¼‰
- [x] Fail2Banå·²å®‰è£…å¹¶é…ç½®
- [x] æ•°æ®åº“å’ŒRediså·²è®¾ç½®å¯†ç å¹¶é™åˆ¶è®¿é—®
- [x] WebæœåŠ¡å™¨å·²è¿›è¡Œå®‰å…¨åŠ å›º
- [x] æ–‡ä»¶æƒé™å·²æ­£ç¡®è®¾ç½®
- [x] æ—¥å¿—ç›‘æ§å’Œè½®è½¬å·²é…ç½®
- [x] è‡ªåŠ¨å¤‡ä»½å·²è®¾ç½®å¹¶æµ‹è¯•
- [x] å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå·²éƒ¨ç½²ï¼ˆOSSEC/AIDEï¼‰
- [x] å®šæœŸå®‰å…¨æ£€æŸ¥è„šæœ¬å·²é…ç½®
- [x] äº‘å¹³å°å®‰å…¨äº§å“å·²å¯ç”¨
- [x] åº”æ€¥å“åº”æµç¨‹å·²å»ºç«‹

### 17.3 æŒç»­æ”¹è¿›å»ºè®®

1. **å®šæœŸæ›´æ–°**
   - æ¯å‘¨æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
   - è®¢é˜…å®‰å…¨å…¬å‘Š
   - åŠæ—¶ä¿®è¡¥æ¼æ´

2. **ç›‘æ§å®¡è®¡**
   - æ¯æ—¥æŸ¥çœ‹æ—¥å¿—
   - æ¯å‘¨è¿è¡Œå®‰å…¨å®¡è®¡
   - æ¯æœˆè¿›è¡Œå…¨é¢æ£€æŸ¥

3. **å›¢é˜ŸåŸ¹è®­**
   - å®‰å…¨æ„è¯†åŸ¹è®­
   - åº”æ€¥å“åº”æ¼”ç»ƒ
   - æœ€æ–°å¨èƒé€šæŠ¥

4. **æµ‹è¯•éªŒè¯**
   - å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤
   - è¿›è¡Œæ¸—é€æµ‹è¯•
   - éªŒè¯å®‰å…¨é…ç½®

5. **æ–‡æ¡£æ›´æ–°**
   - ç»´æŠ¤é…ç½®æ–‡æ¡£
   - æ›´æ–°æ“ä½œæ‰‹å†Œ
   - è®°å½•å®‰å…¨äº‹ä»¶

---

## é™„å½•Aï¼šå¸¸ç”¨å®‰å…¨å‘½ä»¤é€ŸæŸ¥

```bash
# ç³»ç»Ÿä¿¡æ¯
uname -a                    # ç³»ç»Ÿç‰ˆæœ¬
hostnamectl                 # ä¸»æœºä¿¡æ¯
uptime                      # è¿è¡Œæ—¶é—´å’Œè´Ÿè½½

# ç”¨æˆ·ç®¡ç†
whoami                      # å½“å‰ç”¨æˆ·
id                          # ç”¨æˆ·IDä¿¡æ¯
who                         # å½“å‰ç™»å½•ç”¨æˆ·
w                           # è¯¦ç»†ç™»å½•ä¿¡æ¯
last                        # ç™»å½•å†å²
lastb                       # å¤±è´¥ç™»å½•

# è¿›ç¨‹ç®¡ç†
ps aux                      # æ‰€æœ‰è¿›ç¨‹
top                         # å®æ—¶è¿›ç¨‹
htop                        # å¢å¼ºç‰ˆtop
pgrep process_name          # æŸ¥æ‰¾è¿›ç¨‹
pkill process_name          # ç»ˆæ­¢è¿›ç¨‹

# ç½‘ç»œç®¡ç†
ip addr                     # IPåœ°å€
ss -tulpn                   # ç›‘å¬ç«¯å£
netstat -tulpn              # ç½‘ç»œè¿æ¥
lsof -i :80                 # ç«¯å£å ç”¨
iptables -L -n              # é˜²ç«å¢™è§„åˆ™

# æ–‡ä»¶ç®¡ç†
find / -name file           # æŸ¥æ‰¾æ–‡ä»¶
find / -perm -4000          # æŸ¥æ‰¾SUIDæ–‡ä»¶
find / -mtime -1            # æœ€è¿‘ä¿®æ”¹
chmod 600 file              # ä¿®æ”¹æƒé™
chown user:group file       # ä¿®æ”¹æ‰€æœ‰è€…

# æ—¥å¿—ç®¡ç†
tail -f /var/log/syslog     # å®æ—¶æ—¥å¿—
grep ERROR /var/log/*       # æœç´¢é”™è¯¯
journalctl -xe              # systemdæ—¥å¿—
dmesg                       # å†…æ ¸æ—¥å¿—

# ç³»ç»Ÿèµ„æº
df -h                       # ç£ç›˜ä½¿ç”¨
du -sh /*                   # ç›®å½•å¤§å°
free -h                     # å†…å­˜ä½¿ç”¨
iostat                      # IOç»Ÿè®¡
sar -u                      # CPUç»Ÿè®¡
```

---

## é™„å½•Bï¼šå‚è€ƒèµ„æ–™

1. **å®˜æ–¹æ–‡æ¡£**
   - [é˜¿é‡Œäº‘å®‰å…¨é…ç½®å»ºè®®](https://www.alibabacloud.com/help/zh/security-center)
   - [è…¾è®¯äº‘å®‰å…¨æœ€ä½³å®è·µ](https://cloud.tencent.com/document/product/296)
   - [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks/)

2. **å®‰å…¨æ ‡å‡†**
   - ç­‰ä¿2.0å®‰å…¨åŸºçº¿
   - OWASP Top 10
   - PCI DSS

3. **å·¥å…·å®˜ç½‘**
   - [Fail2Ban](https://www.fail2ban.org/)
   - [OSSEC](https://www.ossec.net/)
   - [Lynis](https://cisofy.com/lynis/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-30
**ç»´æŠ¤è€…**: DevOps Team

**å…è´£å£°æ˜**: æœ¬æ–‡æ¡£æä¾›çš„æ˜¯é€šç”¨å®‰å…¨å»ºè®®ï¼Œå…·ä½“å®æ–½æ—¶è¯·æ ¹æ®å®é™…ç¯å¢ƒå’Œéœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒå®æ–½å‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ‰€æœ‰é…ç½®ã€‚

**è®°ä½ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡ï¼**
