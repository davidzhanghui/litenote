# 开发规范与流程

## 1. 开发规范概述

本文档定义了多功能文件编辑器项目的开发规范、编码标准、工作流程和质量保证机制。遵循这些规范有助于提高代码质量、降低维护成本、提升团队协作效率，确保项目的可持续发展。

## 2. 代码规范

### 2.1 JavaScript/TypeScript规范

#### 2.1.1 命名规范
```javascript
// 变量和函数：使用驼峰命名法
const userName = 'john_doe'
const getUserInfo = () => {}

// 常量：使用大写下划线命名
const MAX_FILE_SIZE = 10 * 1024 * 1024
const API_BASE_URL = 'http://localhost:30001'

// 类名：使用帕斯卡命名法
class FileManager {}
class FileTreeComponent {}

// 文件名：使用帕斯卡命名法（组件）或小写下划线（工具）
FileTree.vue
file_utils.js
```

#### 2.1.2 代码格式
```javascript
// 使用2个空格缩进
function processFile(filePath) {
  if (!filePath) {
    throw new Error('文件路径不能为空')
  }
  
  const content = fs.readFileSync(filePath, 'utf8')
  return content.trim()
}

// 对象和数组：尾随逗号
const config = {
  port: 30001,
  host: 'localhost',
  timeout: 5000,
}

// 函数参数：多行时每个参数一行
const createFile = async (
  path: string,
  name: string,
  content: string
): Promise<boolean> => {
  // 实现代码
}
```

#### 2.1.3 注释规范
```javascript
/**
 * 文件操作服务类
 * 提供文件的读取、写入、删除等基础操作
 * 
 * @class FileService
 * @author 开发团队
 * @since 1.0.0
 */
class FileService {
  /**
   * 读取文件内容
   * 
   * @param {string} filePath - 文件路径
   * @param {Object} options - 读取选项
   * @param {string} [options.encoding='utf8'] - 文件编码
   * @returns {Promise<string>} 文件内容
   * @throws {Error} 当文件不存在时抛出错误
   * 
   * @example
   * const content = await fileService.readFile('/path/to/file.md')
   * console.log(content)
   */
  async readFile(filePath, options = {}) {
    const { encoding = 'utf8' } = options
    
    try {
      return await fs.readFile(filePath, encoding)
    } catch (error) {
      throw new Error(`读取文件失败: ${error.message}`)
    }
  }
}
```

### 2.2 Vue组件规范

#### 2.2.1 组件结构
```vue
<template>
  <!-- 模板内容：使用语义化HTML标签 -->
  <div class="file-tree">
    <header class="file-tree__header">
      <h3 class="file-tree__title">{{ title }}</h3>
    </header>
    
    <main class="file-tree__content">
      <ul class="file-tree__list">
        <li 
          v-for="file in files" 
          :key="file.id"
          class="file-tree__item"
          :class="{ 'file-tree__item--active': file.isActive }"
          @click="selectFile(file)"
        >
          <span class="file-tree__icon">{{ file.icon }}</span>
          <span class="file-tree__name">{{ file.name }}</span>
        </li>
      </ul>
    </main>
  </div>
</template>

<script setup lang="ts">
// 导入：第三方库、组件、工具函数
import { ref, computed, onMounted, watch } from 'vue'
import type { FileItem } from '@/types/file'
import { useFileStore } from '@/stores/file'

// Props定义：使用TypeScript类型
interface Props {
  title: string
  files: FileItem[]
  maxHeight?: number
}

const props = withDefaults(defineProps<Props>(), {
  maxHeight: 400
})

// Emits定义：明确的事件类型
interface Emits {
  select: [file: FileItem]
  rename: [fileId: string, newName: string]
  delete: [fileId: string]
}

const emit = defineEmits<Emits>()

// 响应式数据：使用ref和reactive
const selectedFile = ref<FileItem | null>(null)
const isLoading = ref(false)

// 计算属性：使用computed
const filteredFiles = computed(() => {
  return props.files.filter(file => !file.isHidden)
})

// 方法：使用箭头函数
const selectFile = (file: FileItem) => {
  selectedFile.value = file
  emit('select', file)
}

const handleRename = (fileId: string, newName: string) => {
  emit('rename', fileId, newName)
}

// 生命周期：使用组合式API
onMounted(() => {
  loadFiles()
})

// 监听器：使用watch
watch(() => props.files, (newFiles) => {
  console.log('文件列表更新:', newFiles.length)
}, { deep: true })
</script>

<style scoped>
/* 样式：使用BEM命名规范 */
.file-tree {
  border: 1px solid #e4e7ed;
  border-radius: 4px;
  overflow: hidden;
}

.file-tree__header {
  padding: 12px 16px;
  background-color: #f5f7fa;
  border-bottom: 1px solid #e4e7ed;
}

.file-tree__title {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: #303133;
}

.file-tree__content {
  max-height: v-bind('props.maxHeight + "px"');
  overflow-y: auto;
}

.file-tree__list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.file-tree__item {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.file-tree__item:hover {
  background-color: #f5f7fa;
}

.file-tree__item--active {
  background-color: #ecf5ff;
  color: #409eff;
}

.file-tree__icon {
  margin-right: 8px;
  font-size: 16px;
}

.file-tree__name {
  font-size: 14px;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
</style>
```

#### 2.2.2 组件通信规范
```javascript
// 父子组件通信：Props + Emits
// 父组件
<template>
  <FileTree 
    :files="fileList"
    :title="'文件列表'"
    @select="handleFileSelect"
    @rename="handleFileRename"
  />
</template>

// 子组件
const props = defineProps<{
  files: FileItem[]
  title: string
}>()

const emit = defineEmits<{
  select: [file: FileItem]
  rename: [fileId: string, newName: string]
}>()

// 跨组件通信：Provide/Inject
// 祖先组件
provide('fileService', fileService)

// 后代组件
const fileService = inject('fileService')

// 全局状态：Pinia Store
const fileStore = useFileStore()
fileStore.loadFiles()
```

### 2.3 CSS/SCSS规范

#### 2.3.1 命名规范
```scss
// BEM命名规范
.block {}
.block__element {}
.block--modifier {}
.block__element--modifier {}

// 示例
.file-tree {}
.file-tree__header {}
.file-tree__item {}
.file-tree__item--active {}
.file-tree__item--disabled {}
```

#### 2.3.2 样式组织
```scss
// 样式文件结构
@import './variables.scss';    // 变量定义
@import './mixins.scss';       // 混入函数
@import './base.scss';         // 基础样式
@import './components.scss';   // 组件样式
@import './utilities.scss';    // 工具类

// 变量定义
$primary-color: #409eff;
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;

$font-size-small: 12px;
$font-size-base: 14px;
$font-size-large: 16px;

$spacing-small: 8px;
$spacing-base: 16px;
$spacing-large: 24px;

// 混入函数
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin text-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// 响应式设计
@mixin respond-to($breakpoint) {
  @if $breakpoint == 'mobile' {
    @media (max-width: 768px) { @content; }
  } @else if $breakpoint == 'tablet' {
    @media (min-width: 769px) and (max-width: 1024px) { @content; }
  } @else if $breakpoint == 'desktop' {
    @media (min-width: 1025px) { @content; }
  }
}
```

## 3. Git工作流程

### 3.1 分支策略

#### 3.1.1 分支类型
```
main                    # 主分支：生产环境代码
├── develop            # 开发分支：集成最新功能
├── feature/file-tree  # 功能分支：新功能开发
├── bugfix/save-issue  # 修复分支：问题修复
├── hotfix/security    # 热修复分支：紧急修复
└── release/v1.2.0     # 发布分支：版本发布准备
```

#### 3.1.2 分支命名规范
```bash
# 功能分支
feature/功能名称
feature/file-tree
feature/auto-save
feature/code-highlight

# 修复分支
bugfix/问题描述
bugfix/memory-leak
bugfix/file-upload

# 热修复分支
hotfix/紧急问题描述
hotfix/security-vulnerability
hotfix/critical-bug

# 发布分支
release/版本号
release/v1.2.0
release/v2.0.0
```

### 3.2 提交规范

#### 3.2.1 提交消息格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

#### 3.2.2 提交类型
```bash
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动
perf: 性能优化
ci: CI配置文件和脚本的变动
build: 构建系统或外部依赖的变动
```

#### 3.2.3 提交示例
```bash
feat(editor): 添加代码高亮功能

- 集成Monaco Editor
- 支持20+种编程语言
- 添加语法高亮配置选项

Closes #123

fix(file-tree): 修复文件拖拽排序问题

修复文件拖拽后顺序错乱的问题，优化拖拽体验

- 修复拖拽事件处理逻辑
- 添加拖拽动画效果
- 更新单元测试

Fixes #456

docs(readme): 更新安装和使用说明

更新README文档，添加详细的安装步骤和使用示例

- 添加环境要求说明
- 补充配置参数说明
- 添加常见问题解答
```

### 3.3 工作流程

#### 3.3.1 功能开发流程
```bash
# 1. 创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/new-feature

# 2. 开发功能
# ... 编写代码 ...
git add .
git commit -m "feat(feature): 添加新功能"

# 3. 推送分支
git push origin feature/new-feature

# 4. 创建Pull Request
# 在GitHub/GitLab上创建PR到develop分支

# 5. 代码审查
# 团队成员审查代码，提出修改建议

# 6. 合并分支
git checkout develop
git pull origin develop
git branch -d feature/new-feature
```

#### 3.3.2 修复流程
```bash
# 1. 创建修复分支
git checkout main
git pull origin main
git checkout -b hotfix/critical-bug

# 2. 修复问题
# ... 修复代码 ...
git add .
git commit -m "fix: 修复关键bug"

# 3. 推送和合并
git push origin hotfix/critical-bug
# 创建PR到main分支，合并后打tag

# 4. 同步到开发分支
git checkout develop
git pull origin main
```

## 4. 代码审查规范

### 4.1 审查标准

#### 4.1.1 功能性审查
- [ ] 功能是否按照需求正确实现
- [ ] 边界条件是否处理正确
- [ ] 错误处理是否完善
- [ ] 性能是否满足要求

#### 4.1.2 代码质量审查
- [ ] 代码是否遵循编码规范
- [ ] 变量和函数命名是否清晰
- [ ] 代码结构是否合理
- [ ] 是否有重复代码

#### 4.1.3 安全性审查
- [ ] 输入验证是否充分
- [ ] 是否存在安全漏洞
- [ ] 敏感信息是否正确处理
- [ ] 权限控制是否合理

#### 4.1.4 可维护性审查
- [ ] 代码是否易于理解
- [ ] 注释是否充分
- [ ] 模块化程度是否合适
- [ ] 测试覆盖率是否足够

### 4.2 审查流程

#### 4.2.1 Pull Request模板
```markdown
## 变更描述
简要描述本次变更的内容和目的

## 变更类型
- [ ] 新功能
- [ ] 问题修复
- [ ] 文档更新
- [ ] 性能优化
- [ ] 代码重构

## 测试情况
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试完成
- [ ] 性能测试通过

## 检查清单
- [ ] 代码遵循项目规范
- [ ] 添加了必要的测试
- [ ] 更新了相关文档
- [ ] 没有引入新的警告

## 相关Issue
Closes #123

## 截图（如适用）
如果是UI相关变更，请提供截图

## 其他说明
其他需要审查者注意的信息
```

#### 4.2.2 审查意见格式
```markdown
## 总体评价
代码质量良好，功能实现正确

## 建议修改

### 问题1：变量命名不够清晰
**位置**: src/components/FileTree.vue:45
**建议**: 将`data`改为`fileList`，更明确表达含义
**优先级**: 中

### 问题2：缺少错误处理
**位置**: src/services/fileService.js:78
**建议**: 添加try-catch处理文件读取异常
**优先级**: 高

## 优点
1. 组件结构清晰
2. 使用TypeScript提高类型安全
3. 添加了完整的单元测试

## 其他建议
考虑添加加载状态，提升用户体验
```

## 5. 测试规范

### 5.1 测试类型

#### 5.1.1 单元测试
```javascript
// 使用Jest + Vue Test Utils
import { mount } from '@vue/test-utils'
import FileTree from '@/components/FileTree.vue'

describe('FileTree组件', () => {
  test('正确渲染文件列表', () => {
    const files = [
      { id: 1, name: 'test.md', type: 'file' },
      { id: 2, name: 'docs', type: 'directory' }
    ]
    
    const wrapper = mount(FileTree, {
      props: { files }
    })
    
    expect(wrapper.findAll('.file-tree__item')).toHaveLength(2)
    expect(wrapper.text()).toContain('test.md')
    expect(wrapper.text()).toContain('docs')
  })
  
  test('点击文件触发select事件', async () => {
    const files = [{ id: 1, name: 'test.md', type: 'file' }]
    const wrapper = mount(FileTree, {
      props: { files }
    })
    
    await wrapper.find('.file-tree__item').trigger('click')
    
    expect(wrapper.emitted().select).toBeTruthy()
    expect(wrapper.emitted().select[0]).toEqual([files[0]])
  })
})
```

#### 5.1.2 集成测试
```javascript
// API集成测试
import request from 'supertest'
import app from '../server'

describe('文件API', () => {
  test('GET /api/files 返回文件树', async () => {
    const response = await request(app)
      .get('/api/files')
      .expect(200)
    
    expect(response.body).toHaveProperty('tree')
    expect(Array.isArray(response.body.tree)).toBe(true)
  })
  
  test('POST /api/file 保存文件内容', async () => {
    const fileData = {
      path: 'test.md',
      content: '# 测试文档'
    }
    
    const response = await request(app)
      .post('/api/file')
      .send(fileData)
      .expect(200)
    
    expect(response.body.success).toBe(true)
  })
})
```

#### 5.1.3 E2E测试
```javascript
// 使用Cypress进行端到端测试
describe('文件编辑器', () => {
  beforeEach(() => {
    cy.visit('http://localhost:3001')
  })
  
  it('可以打开和编辑文件', () => {
    // 点击文件
    cy.get('.file-tree__item').first().click()
    
    // 验证文件内容加载
    cy.get('.editor__content').should('be.visible')
    
    // 编辑文件
    cy.get('.editor__textarea').type('新的内容')
    
    // 保存文件
    cy.get('.toolbar__save').click()
    
    // 验证保存成功提示
    cy.get('.toast__message').should('contain', '保存成功')
  })
})
```

### 5.2 测试覆盖率

#### 5.2.1 覆盖率要求
- **单元测试覆盖率**: ≥ 80%
- **分支覆盖率**: ≥ 75%
- **函数覆盖率**: ≥ 90%
- **行覆盖率**: ≥ 85%

#### 5.2.2 覆盖率配置
```javascript
// jest.config.js
module.exports = {
  collectCoverage: true,
  collectCoverageFrom: [
    'src/**/*.{js,vue,ts}',
    '!src/main.js',
    '!src/**/*.d.ts'
  ],
  coverageThreshold: {
    global: {
      branches: 75,
      functions: 90,
      lines: 85,
      statements: 80
    }
  }
}
```

## 6. 构建和部署规范

### 6.1 构建配置

#### 6.1.1 开发环境
```javascript
// vite.config.dev.js
export default {
  mode: 'development',
  server: {
    port: 3001,
    proxy: {
      '/api': {
        target: 'http://localhost:30001',
        changeOrigin: true
      }
    }
  },
  build: {
    sourcemap: true,
    minify: false
  }
}
```

#### 6.1.2 生产环境
```javascript
// vite.config.prod.js
export default {
  mode: 'production',
  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'element-plus'],
          editor: ['@monaco-editor/loader']
        }
      }
    }
  }
}
```

### 6.2 部署流程

#### 6.2.1 CI/CD配置
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm run test
      - run: npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to server
        run: |
          # 部署脚本
          scp -r dist/* user@server:/var/www/html/
          ssh user@server 'systemctl reload nginx'
```

## 7. 文档规范

### 7.1 代码文档

#### 7.1.1 API文档
```javascript
/**
 * 文件服务API
 * 
 * @namespace FileAPI
 */

/**
 * 获取文件树结构
 * 
 * @function getFileTree
 * @memberof FileAPI
 * @param {string} [path=''] - 起始路径，空字符串表示根目录
 * @returns {Promise<FileTreeResponse>} 文件树结构
 * @throws {Error} 当路径不存在时抛出错误
 * 
 * @example
 * // 获取根目录文件树
 * const tree = await fileAPI.getFileTree()
 * 
 * // 获取子目录文件树
 * const subTree = await fileAPI.getFileTree('docs')
 */
async function getFileTree(path = '') {
  // 实现代码
}
```

#### 7.1.2 组件文档
```vue
<!--
  @component FileTree
  @description 文件树组件，用于显示和操作文件目录结构
  @example
  <template>
    <FileTree 
      :files="fileList"
      :show-hidden="false"
      @select="handleFileSelect"
    />
  </template>
-->
```

### 7.2 项目文档

#### 7.2.1 README结构
```markdown
# 项目名称

## 简介
简要描述项目功能和特点

## 快速开始
安装和运行步骤

## 功能特性
详细功能列表

## API文档
接口说明

## 开发指南
开发环境搭建和贡献指南

## 部署指南
生产环境部署说明

## 常见问题
FAQ和故障排除

## 更新日志
版本更新记录
```

## 8. 质量保证

### 8.1 代码质量检查

#### 8.1.1 ESLint配置
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'plugin:vue/vue3-essential',
    '@vue/typescript/recommended',
    '@vue/prettier'
  ],
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    '@typescript-eslint/no-unused-vars': 'error',
    'vue/multi-word-component-names': 'off'
  }
}
```

#### 8.1.2 Prettier配置
```json
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 80,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

### 8.2 性能监控

#### 8.2.1 前端性能指标
- **FCP**: First Contentful Paint < 1.5s
- **LCP**: Largest Contentful Paint < 2.5s
- **FID**: First Input Delay < 100ms
- **CLS**: Cumulative Layout Shift < 0.1

#### 8.2.2 后端性能指标
- **响应时间**: API平均响应时间 < 200ms
- **吞吐量**: 支持1000+并发请求
- **错误率**: 错误率 < 0.1%
- **可用性**: 99.9%可用性

## 9. 团队协作

### 9.1 沟通规范

#### 9.1.1 会议规范
- **每日站会**: 15分钟，同步进度和问题
- **周会**: 1小时，回顾和计划
- **技术分享**: 每月一次，技术交流
- **项目回顾**: 每个版本结束后

#### 9.1.2 文档协作
- **技术文档**: 使用Git管理，版本控制
- **设计文档**: 使用共享文档工具
- **会议记录**: 及时整理和分享
- **知识库**: 持续更新和维护

### 9.2 任务管理

#### 9.2.1 任务分解
- **Epic**: 大功能模块
- **Story**: 用户故事
- **Task**: 具体任务
- **Bug**: 问题修复

#### 9.2.2 优先级定义
- **P0**: 紧急，需要立即处理
- **P1**: 高优先级，本周完成
- **P2**: 中优先级，本月完成
- **P3**: 低优先级，有时间时处理

## 10. 持续改进

### 10.1 流程优化

#### 10.1.1 定期回顾
- 每月进行流程回顾
- 收集团队反馈
- 识别改进点
- 制定改进计划

#### 10.1.2 工具升级
- 定期评估开发工具
- 引入新的开发工具
- 优化构建和部署流程
- 提升开发效率

### 10.2 技术债务管理

#### 10.2.1 债务识别
- 定期代码审查
- 性能分析报告
- 安全扫描结果
- 用户反馈分析

#### 10.2.2 债务偿还
- 制定偿还计划
- 分阶段实施
- 跟踪偿还进度
- 验证偿还效果

## 11. 总结

本开发规范与流程文档为项目提供了全面的开发指导，包括代码规范、工作流程、质量保证等各个方面。遵循这些规范有助于：

1. **提高代码质量**: 统一的编码标准和审查机制
2. **提升开发效率**: 清晰的工作流程和工具支持
3. **降低维护成本**: 良好的代码结构和文档
4. **促进团队协作**: 规范的沟通和协作方式
5. **保证项目质量**: 完善的测试和质量监控

所有团队成员都应该熟悉并遵循这些规范，在项目实施过程中不断完善和优化，确保项目的成功交付和可持续发展。
