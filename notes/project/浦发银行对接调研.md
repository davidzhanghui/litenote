# 0.总体方案
- 定时任务1: 每隔30分钟拉取【当天】最新流水
- 定时任务2: 拉取【昨天】全部流水对应的回单

## 1. 查询流水列表
### 1.1 接口 A666 
- （可以排序，方便按时间顺序拉取最新流水）
- 【交易日期+柜员流水号+传票组内序号】三个字段确认一笔明细的唯一性
### 1.2 主要请求参数
- beginNumber： 起始笔数
- queryNumber： 查询笔数（最大20条）
- acctNo：账号
- dateFlag：日期标记。0-交易日期
- beginDate：20251031
- endDate：20251031 两个日期一样表示查询当天。
- ascOrDes： 排序。 0-正序，1-倒序。 对于我们来说必须是正序。

### 1.3 主要响应参数
- totalNumber：总条数。
- acctNo：账号
- tradeList
  - transDate： 交易日期。YYYYMMDD
  - transTime: 交易时间
  - backhostGyno：柜员流水号
  - subpoenaSeqNo： 传票组内序号
  - debitFlag: 0-借 1-贷
  - transAmount: 交易金额
  - acctBalance：账户余额
  - oppositeBankName： 对方行名
  - oppositeAcctNo
  - oppositeBankNo
  - oppositeAcctName
  - remark： 备注
  - summary：摘要
  - isLastTrans： 是否为当天最后一笔。当按交易日期且正序排序查询时输出

### 1.4 示例
#### 1.4.1 请求报文
```xml
<?xml version="1.0" encoding="gb2312"?>
<packet>
	<head>
		<transCode>A666</transCode>
		<signFlag>1</signFlag>
		<masterID>2000040752</masterID>
		<packetID>123456789</packetID>
		<yqzlNo></yqzlNo>
		<timeStamp></timeStamp>
	</head>
	<body>
		<beginNumber>1</beginNumber>
		<queryNumber>10</queryNumber>
		<acctNo>95200078801300000003</acctNo>
		<dateFlag>0</dateFlag>
		<beginDate>20200501</beginDate>
		<endDate>20200601</endDate>
		<minAmount>100</minAmount>
		<maxAmount></maxAmount>
		<ascOrDes>0</ascOrDes>
		<summary></summary>
		<remark></remark>
		<oppositeAcctNo></oppositeAcctNo>
		<oppositeAcctName></oppositeAcctName>
		<oppositeBankNo></oppositeBankNo>
		<oppositeBankName></oppositeBankName>
		<businessCode></businessCode>
		<debitFlag></debitFlag>
		<subpoenaSeqNo></subpoenaSeqNo>
		<reserve1></reserve1>
		<reserve2></reserve1>
		<reserve3></reserve3>
		<reserve4></reserve4>
		<reserve5></reserve5>
		<reserve6></reserve6>
		<reserve7></reserve7>
		<reserve8></reserve8>
		<reserve9></reserve9>
		<reserve10></reserve10>
	</body>
</packet>
```

#### 1.4.2 响应报文
```xml
<?xml version="1.0" encoding="gb2312"?>
<packet>
	<head>
		<transCode>A666</transCode>
		<signFlag>1</signFlag>
		<packetID>123456789</packetID>
		<timeStamp></timeStamp>
		<returnCode>AAAAAAA</returnCode>
	</head>
	<body>
		<totalNumber>27</totalNumber>
		<acctNo>910G9997220004099</acctNo>
		<masterName>浦发2957960286</masterName>
		<currency>01</currency>
		<debtorAmount>2113.00</debtorAmount>
		<lenderAmount>924.00</lenderAmount>
		<note1></note1>
		<note2></note2>
		<note3></note3>
		<note4></note4>
		<note5></note5>
		<lists name="LoopResult">
			<list>
				<transDate>20200507</transDate>
				<hostDate>20200507</hostDate>
				<transTime>104230</transTime>
				<businessCode>9154</businessCode>
				<voucherNo></voucherNo>
				<debitFlag>0</debitFlag>
				<transAmount>140.00</transAmount>
				<acctBalance>27533.23</acctBalance>
				<organNo>9106</organNo>
				<transGy>99106985</transGy>
				<authGy></authGy>
				<backhostGyno>991069850065</backhostGyno>
				<flag>1</flag>
				<summary>171ed042f8c04284</summary>
				<subpoenaSeqNo>1</subpoenaSeqNo>
				<transAcctNo>910G9997220004099</transAcctNo>
<detailStatus></detailStatus>
				<oppositeBankName></oppositeBankName>
				<oppositeAcctNo></oppositeAcctNo>
				<oppositeBankNo></oppositeBankNo>
				<oppositeAcctName></oppositeAcctName>
				<remark></remark>
				<isLastTrans>1</isLastTrans>
				<remark1></remark1>
				<remark2></remark2>
				<remark3></remark3>
				<remark4></remark4>
				<remark5></remark5>
				<reserved1></reserved1>
				<reserved2></reserved2>
				<reserved3></reserved3>
				<reserved4></reserved4>
			</list>
		</lists>
	</body>
</packet>

```



## 2. 拉取流水回单文件
### 2.1 接口 WJ01
- 拉取昨天的所有回单。返回一个zip压缩包，里面包含所有交易对应的回单。
- 回单文件命名格式： 账号_账单日期_柜员流水号_序号_记账交易码_金额_摘要_receipt.pdf，通过日期+柜员流水号+记账交易码和金额和摘要辅助对应
- 根据【日期+柜员流水号+序号】来找到对应的流水

### 2.2 主要请求参数
- fileBusinessType： 1-账单文件
- acctNo： 账号
- fileDownloadPar： 2-20251030， 2表示批量下载。

### 2.3 主要响应参数
- fileStatus：文件状态。0-未生成，1-已生成。 如果返回0，等会再重新拉取。
- fileLength: 文件大小。单位：字节数
- fileFormat: 例如zip、pdf、txt等
- fileName：文件名
- fileBytes： 文件字节流  

### 2.4 示例
#### 2.4.1 请求报文
```xml
124212<?xml version="1.0" encoding="gb2312"?>
<packet>
	<head>
		<transCode>WJ01</transCode>
		<signFlag><1/signFlag>
		<masterID>1234567890</masterID>
		<packetID>1122334455</packetID>
		<timeStamp>2004-07-28 16:14:25</timeStamp>
		<yqzlNo></yqzlNo>
	</head>
	<body>
		<transMasterID>2000040752</transMasterID>
		<acctNo>80222901802583</acctNo>
		<fileBusinessType>1</fileBusinessType>
		<fileDownloadPar>1|20201001</fileDownloadPar>
		<companyId>SPDB</companyId>
		<remark1></remark1>
		<remark2></remark2>
		<remark3></remark3>
		<remark4></remark4>
		<remark5></remark5>
		<remark6></remark6>
	</body>
</packet>
```

#### 2.4.2 响应报文
```xml
123456<?xml version="1.0" encoding="gb2312"?>
<packet>
	<head>
		<transCode>WJ01</transCode>
		<signFlag>1</signFlag>
		<packetID>1122334455</packetID>
		<timeStamp>2004-07-28 16:14:25</timeStamp>
		<returnCode>AAAAAAA</returnCode>
	</head>
	<body>
		<fileStatus>0</fileStatus>
		<fileLength>12520</fileLength>
		<fileFormat>zip</fileFormat>
		<fileName>9301007880165567_103.20_n.zip</fileName>
		<remark1></remark1>
		<remark2></remark2>
		<remark3></remark2>
	</body>
</packet>0F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB6070F09829A678790EB607...........

```







