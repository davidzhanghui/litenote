服务器安全加固是一个重要的系统管理任务，涉及多个层面的配置和防护措施。以下是一个通用的服务器安全加固指南，适用于新申请的Linux服务器：

## 1. 系统更新和补丁管理

首先确保系统和所有软件包都是最新的：

```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL/Rocky Linux
sudo yum update -y
# 或者对于较新版本
sudo dnf update -y
```

## 2. 防火墙配置

启用并配置防火墙，只开放必要的端口：

```bash
# UFW (Ubuntu)
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443

# Firewalld (CentOS/RHEL)
sudo systemctl start firewalld
sudo systemctl enable firewalld
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## 3. SSH安全配置

编辑SSH配置文件以提高安全性：

```bash
sudo nano /etc/ssh/sshd_config
```

修改以下配置项：
```
Port 2222  # 更改默认SSH端口
PermitRootLogin no  # 禁止root直接登录
PasswordAuthentication no  # 禁用密码认证，只允许密钥认证
PubkeyAuthentication yes  # 启用公钥认证
MaxAuthTries 3  # 限制认证尝试次数
ClientAliveInterval 300  # 设置客户端活跃间隔
ClientAliveCountMax 2  # 设置客户端活跃计数最大值
AllowUsers your_username  # 限制允许登录的用户
```

重启SSH服务：
```bash
sudo systemctl restart sshd
```

## 4. 用户和权限管理

创建一个非root用户并授予sudo权限：

```bash
# 创建新用户
sudo adduser newuser

# 添加到sudo组
sudo usermod -aG sudo newuser

# 或者在CentOS中
sudo usermod -aG wheel newuser
```

## 5. 禁用不必要的服务

检查并禁用不必要的系统服务：

```bash
# 查看运行中的服务
sudo systemctl list-units --type=service --state=running

# 禁用不需要的服务，例如：
sudo systemctl disable cups
sudo systemctl disable bluetooth
```

## 6. 配置自动安全更新

设置系统自动安装安全更新：

```bash
# Ubuntu/Debian
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades

# CentOS/RHEL
sudo dnf install dnf-automatic
sudo systemctl enable --now dnf-automatic.timer
```

## 7. 安装和配置入侵检测系统

安装Fail2Ban来防止暴力破解攻击：

```bash
# Ubuntu/Debian
sudo apt install fail2ban

# CentOS/RHEL
sudo dnf install fail2ban

# 启动并启用开机自启
sudo systemctl start fail2ban
sudo systemctl enable fail2ban
```

## 8. 文件系统安全

设置重要文件和目录的权限：

```bash
# 设置敏感文件权限
sudo chmod 600 /etc/shadow
sudo chmod 644 /etc/passwd
sudo chmod 600 /etc/gshadow
sudo chmod 644 /etc/group

# 设置SSH目录权限
sudo chmod 700 ~/.ssh
sudo chmod 600 ~/.ssh/authorized_keys
```

## 9. 日志监控

安装和配置日志监控工具：

```bash
# 安装日志查看工具
sudo apt install logwatch  # Ubuntu/Debian
# 或
sudo dnf install logwatch  # CentOS/RHEL

# 配置定期发送日志报告
sudo nano /etc/cron.daily/00logwatch
```

## 10. 内核安全参数调整

编辑sysctl配置文件以加强内核安全：

```bash
sudo nano /etc/sysctl.conf
```

添加以下参数：
```
# 防止SYN洪水攻击
net.ipv4.tcp_syncookies = 1

# 启用IP转发保护
net.ipv4.ip_forward = 0

# 禁用ICMP重定向
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# 启用源路由验证
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# 记录欺骗包、源路由包和重定向包
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# 禁用接受ICMP重定向
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0

# 禁用安全ICMP重定向
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0

# 启用execshield
kernel.exec-shield = 1
kernel.randomize_va_space = 2
```

应用配置：
```bash
sudo sysctl -p
```

完成这些步骤后，您的服务器安全性将得到显著提升。需要注意的是，安全是一个持续的过程，应该定期审查和更新安全配置。此外，根据您的具体应用需求，可能还需要额外的安全措施，比如应用层防火墙、Web应用防火墙(WAF)等。