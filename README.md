# 多功能文件编辑器

基于 Vue3 + Element Plus + Monaco Editor 的本地文件管理和编辑系统

支持 Markdown、代码文件等 20+ 种文件格式的在线编辑，提供完整的文件管理功能（创建、删除、重命名）和智能自动保存。

## 功能特性

### 文件浏览与编辑

- 📁 树形结构显示目录和文件
- 📚 **多标签页支持** - 同时打开多个文件，快速切换
- ✏️ 实时 Markdown 编辑和预览
- 💻 专业代码编辑器（Monaco Editor）支持 20+ 种编程语言
- 🎨 高亮代码着色（Java、Vue、Bash、Python、JavaScript、TypeScript、C++、Go、Rust、Ruby、PHP、Shell 等）
- 👀 三种视图模式（编辑/预览/双栏）- 仅限 Markdown 文件

### 智能保存

- 💾 智能自动保存（每 5 秒检测变更并自动保存）
- 📝 文件保存状态提示（显示"未保存"和"已自动保存"状态）
- 🎛️ **自动更新开关** - 每个标签独立控制自动保存功能
- ⚡ **性能优化** - 防抖机制避免频繁保存操作

### 文件管理

- 📂 创建目录（右键菜单 → 创建目录）
- 📄 新建文件（右键菜单 → 新建文件，支持 20+ 种文件格式）
- ✏️ 重命名文件/目录（右键菜单 → 重命名）
- 🗑️ 删除文件/目录（右键菜单 → 删除）
- 🔄 实时刷新文件树

### 增强功能

- ⬇️ **文件下载** - 支持下载源文件，显示文件大小信息
- ⌨️ **快捷键支持** - Ctrl+S 保存，Ctrl+W 关闭当前标签
- 🖱️ **右键菜单** - 标签页右键菜单支持关闭操作
- 💾 **标签状态持久化** - 刷新页面后自动恢复打开的标签
- 🎛️ **独立自动更新控制** - 每个标签可单独开启/关闭自动保存

### 其他特性

- 📱 响应式布局
- 🔒 路径安全防护（防止路径遍历攻击）
- ✅ 文件名验证（支持字母、数字、下划线、中划线和中文）

## 快速开始

### 方式一：一键启动（推荐）

```bash
# 给启动脚本添加执行权限
chmod +x start.sh

# 运行启动脚本（会自动安装依赖并启动前后端服务）
./start.sh
```

### 方式二：分步启动

#### 1. 安装依赖

**前端依赖：**

```bash
npm install
```

**后端依赖：**

```bash
cd server
npm install
cd ..
```

#### 2. 启动服务

**启动后端 API 服务（端口 30001）：**

在一个终端窗口中运行：

```bash
cd server
npm start
```

服务启动后会显示：

```
服务器运行在 http://localhost:30001
Markdown 文件目录: /path/to/markdowns
```

**启动前端开发服务器（端口 3001）：**

在另一个终端窗口中运行：

```bash
npm run dev
```

服务启动后会显示：

```
➜  Local:   http://localhost:3001/
```

#### 3. 访问应用

打开浏览器访问：**http://localhost:3001**

## 端口配置

- **前端服务**: `http://localhost:3001`
- **后端 API**: `http://localhost:30001`
- **API 代理**: 前端通过 `/api` 路径代理到后端服务

## 项目结构

```
docs/
├── src/                      # 前端源码
│   ├── components/          # Vue 组件
│   │   ├── FileTree.vue     # 文件树组件
│   │   ├── MarkdownEditor.vue  # Markdown 编辑器
│   │   └── CodeEditor.vue   # 代码编辑器（支持多种脚本文件）
│   ├── api/                 # API 接口
│   │   └── files.js         # 文件操作 API
│   ├── styles/              # 样式文件
│   │   └── main.scss        # 全局样式
│   ├── App.vue              # 主应用组件
│   └── main.js              # 入口文件
├── server/                  # 后端服务
│   ├── server.js            # Express 服务器
│   └── package.json         # 后端依赖配置
├── markdowns/               # 文件存储目录（支持 Markdown 和脚本文件）
│   ├── 示例文档.md
│   ├── example.py           # Python 示例
│   ├── example.js           # JavaScript 示例
│   ├── example.sh           # Shell 示例
│   ├── 学习笔记/
│   └── 项目文档/
├── package.json             # 前端依赖配置
├── vite.config.js           # Vite 配置
├── index.html               # HTML 模板
├── start.sh                 # 一键启动脚本
└── README.md                # 项目说明
```

## 后端 API 接口

### 文件浏览与读写

- **GET** `/api/files`

  - 功能：获取文件树
  - 返回：树形结构的文件和目录列表
- **GET** `/api/file?path=<文件路径>`

  - 功能：读取文件内容
  - 参数：`path` - 文件相对路径
  - 返回：文件内容
- **POST** `/api/file`

  - 功能：保存文件内容
  - 请求体：`{ "path": "文件路径", "content": "文件内容" }`
  - 返回：保存结果

### 目录管理

- **POST** `/api/directory`

  - 功能：创建目录
  - 请求体：`{ "path": "父目录路径", "name": "目录名" }`
  - 返回：`{ "success": true, "path": "新目录路径" }`
- **PUT** `/api/directory`

  - 功能：重命名目录
  - 请求体：`{ "path": "目录路径", "newName": "新名称" }`
  - 返回：`{ "success": true, "newPath": "新路径" }`
- **DELETE** `/api/directory`

  - 功能：删除目录（递归删除）
  - 请求体：`{ "path": "目录路径" }`
  - 返回：`{ "success": true }`

### 文件管理

- **POST** `/api/create-file`

  - 功能：创建新文件
  - 请求体：`{ "path": "父目录路径", "name": "文件名", "extension": "扩展名" }`
  - 返回：`{ "success": true, "path": "新文件路径" }`
- **PUT** `/api/file-rename`

  - 功能：重命名文件
  - 请求体：`{ "path": "文件路径", "newName": "新文件名（含扩展名）" }`
  - 返回：`{ "success": true, "newPath": "新路径" }`
- **DELETE** `/api/file`

  - 功能：删除文件
  - 请求体：`{ "path": "文件路径" }`
  - 返回：`{ "success": true }`

### 其他

- **GET** `/api/supported-extensions`
  - 功能：获取支持的文件扩展名列表
  - 返回：`{ "extensions": [".md", ".txt", ...] }`

## 技术栈

### 前端

- **Vue 3** - 渐进式 JavaScript 框架
- **Element Plus** - Vue 3 组件库
- **Vite** - 下一代前端构建工具
- **Monaco Editor** - 专业代码编辑器（VS Code 核心）
- **@monaco-editor/loader** - Monaco Editor 动态加载器
- **@vueuse/core** - Vue 组合式API工具集
- **Markdown-it** - Markdown 解析器
- **Highlight.js** - 代码语法高亮
- **Axios** - HTTP 客户端
- **Sass** - CSS 预处理器（使用现代编译器 API）

### 后端

- **Node.js** - JavaScript 运行时
- **Express** - Web 应用框架
- **CORS** - 跨域资源共享

## 使用说明

### 基本操作

1. **查看文件**: 点击左侧文件树中的文件名
2. **编辑内容**: 在右侧编辑器中修改文件内容
3. **保存文件**: 点击工具栏的“保存”按钮或等待自动保存
4. **刷新树**: 点击左上角刷新按钮重新加载文件树

### 多标签页功能

- 📚 **打开多个文件**: 点击文件树中的文件，会在顶部标签栏打开新标签
- ♻️ **切换标签**: 点击标签页切换到对应文件
- ❌ **关闭标签**: 点击标签上的 × 按钮关闭文件
- 🔄 **智能切换**: 关闭当前标签后自动切换到相邻标签
- 🚫 **防重复**: 已打开的文件再次点击会直接切换，不会重复打开
- 🎨 **图标区分**: Markdown 文件和代码文件显示不同图标
- 💾 **独立保存**: 每个标签独立管理保存状态
- 🎛️ **自动更新控制**: 每个标签都有独立的自动保存开关
- 🖱️ **右键菜单**: 右键点击标签显示关闭选项菜单
- 💾 **状态持久化**: 刷新页面后自动恢复之前打开的标签和状态
- ⌨️ **快捷键支持**: Ctrl+W 关闭当前标签

**标签右键菜单选项：**

- 关闭当前标签
- 关闭其他标签
- 关闭所有标签
- 关闭左侧标签
- 关闭右侧标签

### 文件管理操作

#### 创建目录

1. 在文件树中右键点击目标目录（或空白区域创建在根目录）
2. 选择"创建目录"
3. 输入目录名称（支持字母、数字、下划线、中划线和中文）
4. 点击确定

#### 新建文件

1. 在文件树中右键点击目标目录
2. 选择"新建文件"
3. 输入文件名（不含扩展名）
4. 选择文件类型（Markdown、Web 开发、编程语言、脚本、数据格式等）
5. 点击确定

**支持的文件格式分类：**

- **Markdown & Text**: .md, .txt
- **Web 开发**: .html, .css, .scss, .less, .js, .jsx, .ts, .tsx, .vue, .xml
- **编程语言**: .py, .java, .c, .cpp, .cc, .h, .go, .rs, .rb, .php
- **脚本语言**: .sh, .bash, .zsh, .fish
- **数据格式**: .json, .yaml, .yml, .sql

#### 重命名文件/目录

1. 在文件树中右键点击要重命名的文件或目录
2. 选择"重命名"
3. 输入新名称
   - 目录：输入新目录名
   - 文件：输入新文件名（需包含扩展名）
4. 点击确定

#### 删除文件/目录

1. 在文件树中右键点击要删除的文件或目录
2. 选择"删除"
3. 确认删除操作
   - ⚠️ **注意**: 删除目录会递归删除其中所有内容
   - ⚠️ **注意**: 删除操作不可恢复，请谨慎操作

### 自动保存功能

- ⏱️ **自动保存间隔**: 每 5 秒检测一次文档变更
- 📝 **状态提示**: 工具栏显示保存状态
  - 黄色标签"未保存" - 表示有未保存的变更
  - 绿色标签"已自动保存" - 表示已自动保存
- 🎛️ **独立控制**: 每个标签页都有独立的自动保存开关
- ⚡ **性能优化**: 使用防抖机制避免频繁的localStorage操作
- 💾 **状态持久化**: 自动保存设置会在页面刷新后保持
- 💡 **智能工作流**: 编辑 → 变更检测 → 防抖延迟 → 自动保存 → 状态更新

### Markdown 文件

- 支持三种视图模式：编辑、预览、双栏
- 使用工具栏按钮切换视图模式
- 支持实时预览和代码高亮
- 自动保存功能同样适用
- ⬇️ **文件下载**: 点击"下载"按钮下载源文件
- ⌨️ **Tab缩进**: 在编辑器中按Tab键插入2个空格缩进

### 文件下载功能

- 📥 **下载源文件**: 点击工具栏的"下载"按钮
- 📊 **文件大小显示**: 下载成功后显示文件大小信息
- 🛡️ **大小限制**: 单个文件最大支持10MB下载
- 🔒 **安全检查**: 下载前进行文件验证和错误处理
- 📝 **智能命名**: 自动使用原文件名作为下载文件名

### 快捷键支持

- **Ctrl+S / Cmd+S**: 保存当前文件
- **Ctrl+W / Cmd+W**: 关闭当前标签页
- **Tab**: 在Markdown编辑器中插入2个空格缩进
- **Esc**: 关闭右键菜单（点击其他区域也可关闭）

### 代码文件编辑（Monaco Editor）

使用专业的 Monaco Editor（VS Code 核心编辑器）编辑代码文件，支持以下语言：

**编程语言**

- **Java** (.java)
- **Python** (.py)
- **JavaScript/JSX** (.js, .jsx)
- **TypeScript/TSX** (.ts, .tsx)
- **C/C++** (.c, .cpp, .h, .cc)
- **Go** (.go)
- **Rust** (.rs)
- **Ruby** (.rb)
- **PHP** (.php)

**脚本语言**

- **Shell/Bash** (.sh, .bash, .zsh, .fish)

**Web 技术**

- **Vue** (.vue)
- **HTML** (.html)
- **CSS/SCSS/LESS** (.css, .scss, .less)
- **XML** (.xml)

**数据格式**

- **JSON** (.json)
- **YAML** (.yaml, .yml)
- **SQL** (.sql)
- **Markdown** (.md)
- **Text** (.txt)

**编辑器特性**

- 🎨 语法高亮
- 🔢 行号显示
- 🗺️ 代码缩小地图
- 📏 自动换行
- 🔧 代码格式化
- ⌨️ 智能缩进
- 💾 自动保存

## 开发指南

### 构建生产版本

```bash
npm run build
```

构建输出位于 `dist/` 目录。

### 预览生产构建

```bash
npm run preview
```

## 常见问题

**Q: 启动时出现 Sass 弃用警告怎么办？**

A: 这是正常的，已在 `vite.config.js` 中配置使用现代 Sass 编译器 API。如果仍然看到警告，请确保 Sass 版本为最新。

**Q: Monaco Editor 加载失败？**

A:

- 确保已运行 `npm install` 安装依赖
- 检查浏览器控制台是否有网络错误
- 尝试清除浏览器缓存并刷新页面
- 确保网络连接正常（Monaco Editor 需要从 CDN 加载资源）

**Q: 自动保存没有工作？**

A:

- 检查后端服务是否正在运行
- 查看浏览器控制台是否有错误信息
- 确保 `markdowns/` 目录有写入权限
- 手动点击"保存"按钮进行测试

**Q: 端口被占用怎么办？**

A: 修改以下文件中的端口配置：

- 前端端口: `vite.config.js` 中的 `server.port`
- 后端端口: `server/server.js` 中的 `PORT` 常量
- 同时更新 `vite.config.js` 中的代理目标 `server.proxy['/api'].target`

**Q: 文件无法保存？**

A: 确保后端服务正在运行，检查 `markdowns/` 目录的读写权限。

**Q: 看不到文件树？**

A: 检查后端服务是否正常启动，浏览器控制台是否有错误信息。

**Q: 无法创建目录或文件？**

A:

- 确保目录名/文件名只包含字母、数字、下划线、中划线和中文
- 检查父目录是否存在
- 确保 `markdowns/` 目录有写入权限
- 查看浏览器控制台是否有错误提示

**Q: 删除文件/目录后无法恢复怎么办？**

A: 删除操作是永久性的，无法直接恢复。建议：

- 重要文件定期备份
- 删除前仔细确认
- 可以考虑使用版本控制系统（如 Git）管理文档

**Q: 右键菜单没有出现？**

A:

- 确保右键点击在文件树区域或标签页区域
- 刷新页面重试
- 检查浏览器控制台是否有 JavaScript 错误

**Q: 下载文件失败？**

A:

- 确保文件大小不超过10MB
- 检查浏览器是否允许下载
- 查看控制台是否有下载相关错误信息
- 尝试使用不同浏览器

**Q: 快捷键不工作？**

A:

- 确保编辑器处于焦点状态
- 检查是否有其他应用占用相同快捷键
- Mac用户请使用Cmd键代替Ctrl键
- 刷新页面重试

**Q: 自动保存开关不起作用？**

A:

- 确保点击了标签页上的开关图标
- 检查浏览器是否允许localStorage
- 查看控制台是否有相关错误信息
- 刷新页面后设置会自动恢复

**Q: 标签页状态没有恢复？**

A:

- 确保浏览器允许localStorage存储
- 检查是否清除了浏览器数据
- 重新打开文件后会自动保存状态

## License

MIT

---

## 📝 更新日志

### v2.1.0 - 性能优化与功能增强 (2024-10-31)

#### 🚀 新增功能

- **文件下载功能**: 支持下载源文件，显示文件大小信息
- **快捷键支持**: Ctrl+S 保存，Ctrl+W 关闭标签，Tab 缩进
- **标签右键菜单**: 支持关闭当前/其他/所有/左侧/右侧标签
- **自动更新开关**: 每个标签独立控制自动保存功能
- **标签状态持久化**: 刷新页面后自动恢复打开的标签

#### ⚡ 性能优化

- **防抖机制**: localStorage操作添加300ms防抖，提升性能
- **响应式优化**: 使用computed属性优化自动保存逻辑
- **配置常量管理**: 统一管理UI参数，消除魔法数字

#### 🛠️ 代码质量

- **错误处理增强**: 完善的文件大小检查和下载错误处理
- **组件通信优化**: 事件驱动的标签关闭机制
- **代码组织**: 模块化设计，提高可维护性

#### 📦 依赖更新

- 添加 `@vueuse/core` 用于组合式API工具
- 优化依赖包排序和版本管理

#### 🔧 技术改进

- CSS动态绑定配置常量
- 智能自动保存判断逻辑
- 完善的边界检查和异常处理

---

### v2.0.0 - 多标签页与文件管理 (2024-10-30)

#### 🎯 重大更新

- **多标签页系统**: 支持同时打开多个文件
- **文件管理功能**: 创建、重命名、删除文件和目录
- **Monaco Editor集成**: 专业代码编辑器支持20+语言
- **右键菜单**: 文件树操作菜单

#### 💾 核心功能

- 智能自动保存系统
- 文件状态实时提示
- 路径安全防护
- 响应式布局设计

---

### v1.0.0 - 基础版本 (2024-10-29)

#### 🎉 初始发布

- Vue3 + Element Plus 基础架构
- Markdown 编辑和预览
- 文件树浏览功能
- 基础文件读写操作
